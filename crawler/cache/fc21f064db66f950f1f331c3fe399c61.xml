<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:cc="http://cyber.law.harvard.edu/rss/creativeCommonsRssModule.html">
    <channel>
        <title><![CDATA[Stories by Riccardo Carlesso on Medium]]></title>
        <description><![CDATA[Stories by Riccardo Carlesso on Medium]]></description>
        <link>https://medium.com/@palladiusbonton?source=rss-b5293b96912f------2</link>
        <image>
            <url>https://cdn-images-1.medium.com/fit/c/150/150/1*OT2alojsWtYC4OHgxNdDtg.jpeg</url>
            <title>Stories by Riccardo Carlesso on Medium</title>
            <link>https://medium.com/@palladiusbonton?source=rss-b5293b96912f------2</link>
        </image>
        <generator>Medium</generator>
        <lastBuildDate>Fri, 19 Apr 2024 17:49:21 GMT</lastBuildDate>
        <atom:link href="https://medium.com/@palladiusbonton/feed" rel="self" type="application/rss+xml"/>
        <webMaster><![CDATA[yourfriends@medium.com]]></webMaster>
        <atom:link href="http://medium.superfeedr.com" rel="hub"/>
        <item>
            <title><![CDATA[Gemma is born!]]></title>
            <link>https://medium.com/google-cloud/gemma-is-born-c5ea9ba576ec?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/c5ea9ba576ec</guid>
            <category><![CDATA[machine-learning]]></category>
            <category><![CDATA[gemma]]></category>
            <category><![CDATA[google-cloud-platform]]></category>
            <category><![CDATA[curl]]></category>
            <category><![CDATA[vertex-ai]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Mon, 26 Feb 2024 16:23:09 GMT</pubDate>
            <atom:updated>2024-03-05T15:38:18.048Z</atom:updated>
            <content:encoded><![CDATA[<p>As a rubyist, I loveÂ gems.</p><p>So imagine my delight and surprise when last week <a href="https://blog.google/technology/developers/gemma-open-models/">Google announced <strong>Gemma</strong></a>, a family of open models available directly on `Kaggle`: <a href="https://www.kaggle.com/models/google/gemma">google/gemma</a>. Plus, itâ€™sÂ <em>free</em>!</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/925/1*zktJLAqzgGa4ISoynpyMSQ.jpeg" /><figcaption>Gemma isÂ born!</figcaption></figure><h4>But I know nothing about ML andÂ Kaggle!</h4><p>If youâ€™re like me, a CLI kind of person, fear no more! I found a way to call Gemma with cURL (<a href="https://www.youtube.com/watch?v=1ZXHsNqkDI4">â€œif you can curl it, you can call it in any language!â€</a>â€Šâ€”â€Šsaid a wise man in Dodgeballâ€Šâ€”â€ŠdidÂ he?).</p><p>Donâ€™t believe me? Check out my ugly bash code here: <a href="https://github.com/palladius/genai-googlecloud-scripts/tree/main/10-gemma-is-born">https://github.com/palladius/genai-googlecloud-scripts/tree/main/10-gemma-is-born</a>/</p><h4>How do I install GemmaÂ locally?</h4><p>I havenâ€™t tried that one out, Iâ€™m sorry. Itâ€™s in my todoÂ list.</p><h4>How do I install Gemma in theÂ Cloud?</h4><p>As Barney would say <em>â€œGlad you asked!â€. </em>I got hooked by <a href="https://www.youtube.com/watch?v=BM3wzKSPOoI">this great video</a> by Mark Ryan which got meÂ started.</p><p>Please note that in this case you need <a href="https://cloud.google.com/docs/get-started">access to Google Cloud</a> and have billing enabled. You need:<br>1. A Gmail account (Google Account)<br>2. A Google Cloud Project with <a href="https://cloud.google.com/billing/docs/how-to/modify-project">billingÂ enabled</a>.</p><p>If this doesnâ€™t scare you off, the easiest way isÂ to:</p><ol><li>Click on <a href="https://www.kaggle.com/models/google/gemma">https://www.kaggle.com/models/google/gemma</a></li><li>Click on <a href="https://console.cloud.google.com/vertex-ai/publishers/google/model-garden/335">Gemma on Vertex Model Garden</a> in thatÂ page.</li><li>Follow instructions.</li></ol><p>Once done, you should have something likeÂ this:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*jucMU_v822feb70TLKSDBw.png" /><figcaption>Gemma has been installed</figcaption></figure><h4>Ok, so what now? How do I interact withÂ Gemma?</h4><p>Glad youÂ asked!</p><ul><li>Click on the model (blue lineÂ above).</li><li>Under â€œDeploy and Testâ€ tab you should see an awesome â€œTest your model â€. It accepts aÂ JSON.</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*qGEh59zcn_abB4XBA9Ossg.png" /></figure><p>It took me one hour of digging but I can tell you, the JSON can be as simple asÂ this:</p><pre>{<br>  &quot;instances&quot;: [{<br>    &quot;prompt&quot;: &quot;What&#39;s the difference between a city bike and a racing bike?&quot;,<br>    &quot;max_tokens&quot;: 1000<br>  }]<br>}</pre><p>The output will look likeÂ this:</p><pre>{<br>  &quot;predictions&quot;: [<br>    &quot;.. GEMMA_ANSWER_HERE ...&quot;<br>  ],<br>  &quot;deployedModelId&quot;: &quot;6852805176160419840&quot;,<br>  &quot;model&quot;: &quot;projects/980606839737/locations/us-central1/models/google_gemma-7b-it-1708849093570&quot;,<br>  &quot;modelDisplayName&quot;: &quot;google_gemma-7b-it-1708849093570&quot;,<br>  &quot;modelVersionId&quot;: &quot;1&quot;<br>}</pre><p>So writing a shell wrapper is as easy as cURLplus ajq(latest codeÂ <a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/10-gemma-is-born/gemma-hello.sh">here</a>):</p><pre># You just change these to your model_id and your project_id<br>ENDPOINT_ID=&quot;6294864597715255296&quot;<br>PROJECT_NUMBER=&quot;980606839737&quot;<br># this contains the question<br>INPUT_DATA_FILE=&quot;gemma-input-hello.json&quot;<br># this contains the answer (not really needed but good for training purposes)<br>OUTPUT_DATA_FILE=&quot;gemma-output-hello.json&quot;<br><br>curl \<br>    -X POST \<br>    -H &quot;Authorization: Bearer $(gcloud auth print-access-token)&quot; \<br>    -H &quot;Content-Type: application/json&quot; \<br>    https://us-central1-aiplatform.googleapis.com/v1/projects/${PROJECT_NUMBER}/locations/us-central1/endpoints/${ENDPOINT_ID}:predict \<br>    -d &quot;@${INPUT_DATA_FILE}&quot; | tee &quot;$OUTPUT_DATA_FILE&quot;<br><br>PREDICTION=$(cat &quot;$OUTPUT_DATA_FILE&quot; | jq .predictions[0])<br><br>echo -en &quot;$PREDICTION\n&quot;</pre><h4>Conclusions</h4><p>Deploying Gemma to Vertex AI and calling the model via curl is aÂ <em>breeze</em>.</p><p>And you, what are you waitingÂ for?</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=c5ea9ba576ec" width="1" height="1" alt=""><hr><p><a href="https://medium.com/google-cloud/gemma-is-born-c5ea9ba576ec">Gemma is born!</a> was originally published in <a href="https://medium.com/google-cloud">Google Cloud - Community</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Hey Gemini, explain me these picturesâ€Šâ€”â€Šin bash â€]]></title>
            <link>https://blog.devops.dev/hey-gemini-explain-me-these-pictures-in-bash-06c03d0d0512?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/06c03d0d0512</guid>
            <category><![CDATA[bash]]></category>
            <category><![CDATA[gemini]]></category>
            <category><![CDATA[curl]]></category>
            <category><![CDATA[genai]]></category>
            <category><![CDATA[google]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Thu, 14 Dec 2023 15:16:16 GMT</pubDate>
            <atom:updated>2023-12-21T17:23:54.037Z</atom:updated>
            <content:encoded><![CDATA[<h3>Hey Gemini, explain me these picturesâ€Šâ€”â€Šin bashÂ ğŸ§‘ğŸ½â€ğŸ’»</h3><p><a href="https://www.youtube.com/watch?v=jV1vkHv4zq8"><strong>Gemini</strong> is finallyÂ out</a>!</p><p>Andâ€¦ itâ€™s <strong>multimodal</strong>! Which means, you can use both images and text to ask for questions (the output is only textâ€Šâ€”â€Šfor nowÂ ğŸ˜‰).</p><p>Note: all the code snippets (and images) in here are available in my <a href="https://github.com/palladius/genai-googlecloud-scripts/tree/main/07-bash-gemini-multimodal-jam"><strong>GitHubÂ repo</strong></a>.</p><p>Letâ€™s getÂ started!</p><h3>Hey Gemini, describe what youÂ see..</h3><p>Letâ€™s start by an album by my favourite band:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/536/0*gbubXqodziySrF_A" /><figcaption>One of my favourite albums of all timeâ€Šâ€”â€Šwill Gemini recognize it?</figcaption></figure><pre>$ ./gemini-generic.sh images/genesis-selling-england.jpg Describe what you see<br># ğŸ¤Œ  QUESTION: Describe what you see<br># ğŸŒ¡ï¸ TEMPERATURE: 0.2 <br># ğŸ‘€ Examining image images/genesis-selling-england.jpg: JPEG image data, JFIF standard 1.01, resolution (DPI), density 96x96, segment length 16, baseline, precision 8, 536x528, components 3. <br># â™Š Gemini no Saga answer for you:<br>The cover of Genesis album Selling England by the Pound features a painting <br>by British artist Paul Whitehead. The painting depicts a group of people in <br>a park, with a man sleeping on a bench in the foreground. The people are all<br>wearing clothes from the 1920s or 1930s, and the painting has a nostalgic, <br>almost surreal feel to it. The colors are muted and the figures are slightly <br>blurred, which gives the painting a dreamlike quality. The painting is also <br>full of symbolism, with the sleeping man representing England and the people <br>around him representing the different aspects of English society. The painting<br>has been interpreted in many different ways, but it is generally seen as a<br>commentary on the state of England in the 1970s.</pre><p><em>â™Š The cover of Genesisâ€™ album Selling England by the Pound features a painting by British artist Paul Whitehead. The painting depicts a group of people in a park, with a man sleeping on a bench in the foreground. The people are all wearing clothes from the 1920s or 1930s, and the painting has a nostalgic, almost surreal feel to it. The colors are muted and the figures are slightly blurred, which gives the painting a dreamlike quality. The painting is also full of symbolism, with the sleeping man representing England and the people around him representing the different aspects of English society. The painting has been interpreted in many different ways, but it is generally seen as a commentary on the state of England in theÂ 1970s.</em></p><p>A quick googling confirms that <a href="https://en.wikipedia.org/wiki/Paul_Whitehead">Paul Whitehead</a> actually covered one of my favourite album of all times. If you love Genesis too and want to see me play Firth of Fifth, please check <a href="https://www.youtube.com/watch?v=4VBxd9n1dSU">my youtubeÂ video.</a></p><p>Letâ€™s try this catÂ now:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/320/0*maiP4twRlm4le8Qx" /><figcaption>This is a cat from Google sampleÂ images</figcaption></figure><p><strong>Gemini</strong>: A cat is walking in the snow. The cat is brown and white and has a long tail. The cat is looking at the camera. The snow is white and is covering theÂ ground.</p><h4>How did I doÂ it?</h4><p>If you check my bash script (<a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/07-bash-gemini-multimodal-jam/gemini-generic.sh">gemini-generic.sh</a>), you can see the request looks likeÂ this:</p><pre>data=$(_base64_encode_mac_or_linux &quot;$IMAGE&quot;) # Mac or Linux should both work!<br># ...<br>cat &gt; &quot;$REQUEST_FILE&quot; &lt;&lt;EOF<br>{&#39;contents&#39;: {<br>      &#39;role&#39;: &#39;USER&#39;,<br>      &#39;parts&#39;: [<br>        {&#39;text&#39;: &#39;$QUESTION&#39;},<br>        {&#39;inline_data&#39;: {<br>            &#39;data&#39;: &#39;$data&#39;,<br>            &#39;mime_type&#39;:&#39;image/jpeg&#39;}}]<br>    }<br><br>}<br>EOF</pre><p>The hardest part is actually the base64conversion, and making it work both on my Mac and on my Linux (as our grand-parents say in Italy <em>â€œYou wanted </em><em>/bin/bash.? Now you pedal!â€</em>).</p><h4>An Italian image, explained inÂ Italian</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/926/0*KyG34HB0fyBRdHH8" /><figcaption>The city of XXX, in Italy. Seen from the YYY palace (surprise!). Picture from my colleague Daria.</figcaption></figure><pre>./gemini-explain-image.sh images/italian-town.jpg<br>[..]<br> This is a view of the city of Trento, Italy from the Buonconsiglio Castle.</pre><p><strong>Gemini (</strong><em>ğŸ‡¬ğŸ‡§</em><strong>): </strong><em>This is a view of the city of Trento, Italy from the Buonconsiglio Castle.</em></p><p>Letâ€™s ask the same inÂ Italian:</p><pre>$ GENERATE_MP3=true ./gemini-explain-image-italian.sh images/italian-town.jpg<br># ğŸ¤Œ  QUESTION: Descrivimi cosa vedi in questa immagine<br># ğŸŒ¡ï¸  TEMPERATURE: 0.2<br># ğŸ‘€ Examining image images/italian-town.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, Exif Standard: [TIFF image data, little-endian, direntries=1, software=Google], baseline, precision 8, 926x1230, components 3.<br># â™Š Gemini no Saga answer for you:<br> La foto mostra una loggia con delle colonne in pietra che incorniciano la vista di una cittÃ .<br> La cittÃ  Ã¨ circondata da montagne e si possono vedere i tetti delle case e le torri delle chiese.<br> Il cielo Ã¨ azzurro e ci sono delle nuvole bianche.<br># TTS_LANG: it-IT<br>Written .tmp.tts-output.json. curl_ret=0<br>t.audio.encoded: ASCII text, with very long lines (65536), with no line terminators<br>t.mp3:           MPEG ADTS, layer III, v2,  32 kbps, 24 kHz, Monaural<br>t.mp3: MPEG ADTS, layer III, v2,  32 kbps, 24 kHz, Monaural<br>All good. MP3 created: &#39;t.La foto mostra una loggia con delle colonne in pie.mp3&#39;</pre><p>Gemini (ğŸ‡®ğŸ‡¹): <em>La foto mostra una loggia con delle colonne in pietra che incorniciano la vista di una cittÃ . La cittÃ  Ã¨ circondata da montagne e si possono vedere i tetti delle case e le torri delle chiese. Il cielo Ã¨ azzurro e ci sono delle nuvoleÂ bianche.</em></p><p>As you see, Italian is more verbose (my wife says the same about me!) but itâ€™s not aware of the <a href="https://www.buonconsiglio.it/">Buonconsiglio Palace</a>. Interesting! I presume the Italian model has less training material to learn from than the EnglishÂ one.</p><p>Makes sense.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*kM6xWj1LtmR46I0q" /><figcaption>Btw, I highly recommend Trento, I was cycling around there: great views and greatÂ wines!</figcaption></figure><h4>Comparing twoÂ images</h4><p>How about comparing twoÂ images?</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/786/1*yiGN2IyD-eaLglpR63_Krw.png" /><figcaption>Gemini constellation vs Saint Seiyaâ€™s GeminiÂ saint.</figcaption></figure><p>Some sample code is in my Makefile for convenience. tryÂ this:</p><pre>ricc@derek:~/git/genai-googlecloud-scripts/07-bash-gemini-multimodal-jam$ ğŸ¼ !mak<br>make compare-two-geminis <br>./gemini-generic-two-pics.sh  images/gemini-constellation.png   images/saga-blue-hair.jpg<br>â™Šï¸ Question: Can you highlight similarity and differences between the two? Also, do you recognize the same person in both of them?<br> ğŸ‘€ Examining image1 images/gemini-constellation.png: images/gemini-constellation.png: PNG image data, 1675 x 1302, 8-bit/color RGBA, non-interlaced. <br> ğŸ‘€ Examining image2 images/saga-blue-hair.jpg: images/saga-blue-hair.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, baseline, precision 8, 193x261, components 3. <br>â™Šï¸ Describing attached image:<br> The two images are of the constellation Gemini and the anime character Gemini Saga. The constellation is said to represent the twins Castor and Pollux, while the character Gemini Saga is a Gemini Saint in the anime series Saint Seiya. Both images depict two figures that are connected to each other. The constellation is made up of stars, while the character is a human.</pre><p><strong>â™Š Response</strong>: ï¸ <em>The two images are of the constellation Gemini and the anime character Gemini Saga. The constellation is said to represent the twins Castor and Pollux, while the character Gemini Saga is a Gemini Saint in the anime series Saint Seiya. Both images depict two figures that are connected to each other. The constellation is made up of stars, while the character is aÂ human.</em></p><p>Today weâ€™ve learnt something we certainly didnâ€™t know: a constellation is made of stars, while the guy on the right is humanÂ ğŸ˜ƒ</p><h4>Introducing Audio!</h4><p>Why donâ€™t we throw some audio in theÂ mix?</p><p>Iâ€™ve added a tts.shÂ , which creates an MP3 out of an english (or Italian!) text given in ARGV. Convenient uh?</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*-QOBFPt1GsVq2LVK" /><figcaption>My kids beside American Santa Klaus (we live in Zurich, thereâ€™s a Santa for every language and ethnicity!)</figcaption></figure><p>A few weeks ago my kids went to visit Santa Klaus.. the American Santaâ€Šâ€”â€Štheyâ€™ll tell you thereâ€™s another who speaks German instead, heâ€™s called <em>Samiklaus</em>, they still canâ€™t decide if its the same guyâ€Šâ€”â€Šmy kids are X and Y year old; how old? Letâ€™s askÂ Gemini!</p><pre>$ make age-test<br># equivalent to:<br>$ GENERATE_MP3=true ./gemini-generic.sh images/ricc-family-with-santa.jpg Tell me the age of the people you see, from left to right.<br># ğŸ¤Œ  QUESTION: Tell me the age of the people you see, from left to right.<br># ğŸŒ¡ï¸  TEMPERATURE: 0.2<br># ğŸ‘€ Examining image images/ricc-family-with-santa.jpg: JPEG image data, JFIF standard 1.01, aspect ratio, density 1x1, segment length 16, Exif Standard: [TIFF image data, little-endian, direntries=3, software=Google], baseline, precision 8, 1164x826, components 3.<br># â™Š Gemini no Saga answer for you:<br>1. 30-35<br>2. 2-3<br>3. 40-45<br>4. 2-3<br>5. 60-65<br>[..]<br>All good. MP3 created [..]</pre><p>Now Iâ€™m older than 40â€“45 (46) so technically speaking this is a mistake, but as a human interaction I will consider it as a successÂ ğŸ˜‰</p><p>Now this is not the best of MP3s, but it works! Check out <a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/07-bash-gemini-multimodal-jam/images/ricc-family-with-santa.jpg.mp3">ricc-family-with-santa.jpg.mp3</a>.</p><p>You can also find Trento in Italian here: <a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/07-bash-gemini-multimodal-jam/images/italian-town.jpg.mp3">italian-town.jpg.mp3</a>.</p><h4>Something useful now: understand aÂ diagram!</h4><p>A colleague told me yesterday: the power of Gemini is that not only â€œheâ€ understands text and images, also the very complex relationship between items in a diagram. This morning my Accrux earphones wouldnâ€™t work, so I decided to understand how they work. I downloaded the <a href="https://raw.githubusercontent.com/palladius/genai-googlecloud-scripts/main/07-bash-gemini-multimodal-jam/images/instruction-manuals/Acrux-User-Manual-4700503.pdf">User Manual</a>, uploaded to Gemini <a href="https://raw.githubusercontent.com/palladius/genai-googlecloud-scripts/main/07-bash-gemini-multimodal-jam/images/instruction-manuals/Acrux-User-Manual-4700503.png">as image</a>, and asked Gemini a few questions.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*hfF-icWAS9U4T30e.png" /><figcaption>Iâ€™m not so young anymore so I canâ€™t read this unless itâ€™s printed on A3. And I respect Amazon tooÂ much!</figcaption></figure><p>From UI, this is <em>easy peasy</em>. Upload image and ask question:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/612/0*TXJPDl-xEJFt6FEL" /></figure><p>And what about bash? Letâ€™s do the same fromÂ CLI:</p><pre>$ make read-instruction-manual-for-me <br>[..]<br>./gemini-generic.sh images/instruction-manuals/Acrux-User-Manual-4700503.png &#39;1. How do i TURN it on? 2. Where is the power button located? 3. Is this the one called ANC?&#39;<br># ğŸ¤Œ  QUESTION: 1. How do i TURN it on? 2. Where is the power button located? 3. Is this the one called ANC?<br># ğŸŒ¡ï¸  TEMPERATURE: 0.2 <br># ğŸ‘€ Examining image images/instruction-manuals/Acrux-User-Manual-4700503.png: PNG image data, 1664 x 929, 8-bit/color RGBA, non-interlaced. <br># â™Š Gemini no Saga answer for you:<br>1. Long press the power button for 2 seconds.<br>2. The power button is located on the right earcup.<br>3. Yes, this is the one called ANC.<br># Note: No mp3 file generated (use GENERATE_MP3=true to generate one)</pre><p>My question (I actually asked the questions one by one, so think of it as an avalanche-chat):</p><ol><li>How do i TURN itÂ on?</li><li>Where is the power buttonÂ located?</li><li>Is this the one calledÂ ANC?</li></ol><p># â™Š Gemini answer:<br><em>1. Long press the power button for 2 seconds.<br>2. The power button is located on the right earcup.<br>3. Yes, this is the one calledÂ ANC.</em></p><p>Bingo!</p><h4>An unexpected Games of Thrones plotÂ twist</h4><p>This is the avatar I use in Google. Iâ€™m really curious to see what gemini can infer from here, also because I used someÂ filters.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/600/0*w_qhJiiXjD2ZudEZ" /><figcaption>Riccardo in the Amsterdam office, a few years/kilos ago.</figcaption></figure><pre>$ ./gemini-explain-image.sh images/ricc-logo.png<br>[..]<br>This is a photo of a man standing behind a Google Cloud Platform cutout.<br>The man is smiling and wearing a shirt that says, â€œThatâ€™s what I do,<br>I drink and I know things.â€ The background is a brick wall with blue<br>and white accents.</pre><p><strong>â™Š </strong>Gemini:<em> This is a photo of a man standing behind a Google Cloud Platform cutout. The man is smiling and wearing a shirt that says, â€œThatâ€™s what I do,<br>I drink and I know things.â€ The background is a brick wall with blue<br>and whiteÂ accents.</em></p><p>And I thought! Of course, this is my favourite Games of Thrones t-shirt. Letâ€™s see if heÂ knows:</p><p><strong><em>Q: Do you recognize the quote in this personÂ tshirt?</em></strong></p><pre>$ GENERATE_MP3=true ./gemini-generic.sh images/ricc-logo.png Do you recognize the quote in this person tshirt<br>[..]<br> &quot;That&#39;s what I do, I drink and I know things&quot; is a quote from the TV show Game of Thrones,<br> said by the character Tyrion Lannister.</pre><p><strong>â™Š </strong>Response: <em>â€œThatâ€™s what I do, I drink and I know thingsâ€ is a quote from the TV show Game of Thrones, said by the character Tyrion Lannister.</em></p><p>And you also have the MP3 if you wish: <a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/07-bash-gemini-multimodal-jam/images/ricc-logo.png.mp3">images/ricc-logo.png.mp3</a></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1000/0*gz3JRSvt3G_-iDcm" /></figure><p><em>Chapeau</em>, Gemini!</p><h4>Conclusions</h4><p>Calling Gemini is easy, fun and powerful!</p><ul><li><strong>Easy</strong>. If you can invoke Gemini via curl, imagine how easy it is to invoke it with your favourite language! <a href="https://cloud.google.com/vertex-ai/docs/generative-ai/start/quickstarts/quickstart-multimodal"><strong>Try out our SDK</strong></a><strong> </strong>in Python, Node, Java, Go. For everything else thereâ€™s REST/cURL!</li><li><strong>Fun</strong>. look at how many use cases Iâ€™ve shown in this page: comparing two images, asking questions abuot an image, a writing, age of people,Â .. possibilities areÂ endless.</li><li><strong>Powerful</strong>. Multi-modal is a game changer. And for what I hear, <em>more modes are coming</em>.Â ğŸ˜‰</li></ul><p>Did you like this? Want more of this? Write it in the comments!</p><p>Riccardo</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=06c03d0d0512" width="1" height="1" alt=""><hr><p><a href="https://blog.devops.dev/hey-gemini-explain-me-these-pictures-in-bash-06c03d0d0512">Hey Gemini, explain me these picturesâ€Šâ€”â€Šin bash ğŸ§‘ğŸ½â€ğŸ’»</a> was originally published in <a href="https://blog.devops.dev">DevOps.dev</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Hey Bard, write a responsive Javascript Search Engine app for me..]]></title>
            <link>https://medium.com/@palladiusbonton/hey-bard-write-a-responsive-javascript-search-engine-app-for-me-b2585e55385e?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/b2585e55385e</guid>
            <category><![CDATA[javascript]]></category>
            <category><![CDATA[bard-ai]]></category>
            <category><![CDATA[google-cloud-run]]></category>
            <category><![CDATA[search]]></category>
            <category><![CDATA[json]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Mon, 20 Nov 2023 14:01:41 GMT</pubDate>
            <atom:updated>2023-12-19T10:11:19.056Z</atom:updated>
            <cc:license>http://creativecommons.org/licenses/by/4.0/</cc:license>
            <content:encoded><![CDATA[<p>I suck at Javascript. ğŸ˜’ Itâ€™s time to admit it. ğŸ˜… Letâ€™s see how <strong>Bard</strong> helped me overcome this limitationâ€¦ and create <a href="https://js-simple-search-bsl7ylv4hq-ew.a.run.app/">thisÂ app</a>!</p><p>I tried for years to cope and survive in a world which seems to be unable to exist without Javascript, and last weekend I succumbed. Time to ask your favorite JS developer <a href="https://medium.com/@ch.stanger">Chris</a> to point you at some good documentation and start reading about this weird language.</p><p><strong><em>Promises, promisesâ€¦</em></strong> unless? Wait, what if an <strong>LLM</strong> could code the app for me? Maybe Iâ€™m not good to start the project myself, but what if <a href="https://bard.google.com/">Bard</a> can do it for me, I should be able to tweak the codeÂ myself.</p><p><strong>TL;DR</strong> If you donâ€™t want to read my Italian drama, <a href="https://github.com/palladius/js-simple-seach">jump to the code</a> (or see the <a href="https://js-simple-search-bsl7ylv4hq-ew.a.run.app/">result on CloudÂ Run</a>).</p><p>Two days ago, I was babysitting my kids; playing with my mobile phone while they were playing withÂ Legoâ€¦</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*GRWdYdfz_8efocft" /><figcaption>Little Seby in the Lego room in GoogleÂ Zurich</figcaption></figure><p>.. and I started asking Bard a question. But wait, <em>â€œhow do I make sure the question remains available when I go back home to my big computer?â€</em> I was quite surprised by theÂ answer.</p><h4>The CodingÂ concept</h4><p>Whatâ€™s my idea? Say <strong>you have a gazillion articles / assets and want to be fast at searching on them</strong>. But you canâ€™t accept a 1â€“2 seconds latency from a typical server-side websiteÂ search.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/970/0*hWAdQ_6qqfONWXn1" /><figcaption>Flash is searching through all my docs ina static, local <em>JSON</em>! Barry likes to win easyÂ :)</figcaption></figure><p>I want a search bar where I can start typing stuff and the choice starts to diminish. Then I want to have a number of cards with the results (from a static JSONâ€Šâ€”â€ŠIâ€™ll make it dynamic in a next episode!). I also want to have some rudimental clicking to narrow down the choice, say with a Boolean â€œis this a technical article).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*_glEQUM0vp5CBAJ_" /><figcaption>A quick and customizable searchÂ bar.</figcaption></figure><h4>Write a goodÂ prompt</h4><p>My kids are delving into plenty of Legos, so I have plenty of time to try a verbose and well planned prompt. After all, I want it to write an app for me! Letâ€™s not save time andÂ details.</p><p>Prompt 1: â€œ<strong><em>I would like to build a small and responsive search engine. The DB Is small and static so I donâ€™t need anything complicated. I just want to have a frontend JavaScript where you start typing a word and it searches for all the elements matching this word in title or description. The only important thing to me is responsiveness so every time you type a letter it starts selecting just things matching it, so you want to write say â€œpistachioâ€, the selection should start kicking in already with â€˜pâ€™, â€˜piâ€™, â€˜pisâ€™, and so on. Can you help me write theÂ code?</em></strong>â€</p><p>Iâ€™m so ignorant on JS that Iâ€™m not even sure this is something you can do fully on client-side ( index.html+ script.js) or if you need some server-side effort (add node.jsto the mix) to provide the JSON (although on the server-side I have 20-year expertiseâ€Šâ€”â€Šthis part I can do withoutÂ help).</p><h4>Bard reply might surpriseÂ you..</h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*aZIktNHDSVE0nl-MhdHkPw.png" /><figcaption>Bard answer</figcaption></figure><p>Now, Bard started with a confident â€œ<em>Sure, hereâ€™s the JavaScript code for a small and responsive search engine that works with a static database:</em>â€ but I donâ€™t trust what I see. Plus, I donâ€™t have a computer with me, so I canâ€™t try the code. I asked him to do two things that Google is really good atÂ doing:</p><ul><li>export in email (cheap / persistent)</li><li>export to <a href="https://docs.google.com/document/d/1y75TsYpu9kr3vh0zEEoq-IpBTfmbJ77fsISVKbHsRRU/edit">GDoc</a> (richer / canÂ edit)</li></ul><p>Look:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*7AU7_E2Wql-JTjPmC8Zz-A.png" /><figcaption><strong>Bard</strong> exports to <strong>GDocs</strong> and <strong>GMail</strong> in case you want to elaborate on your brainstorming idea.</figcaption></figure><p>When I was home I had plenty to choose from: my ğŸ“¬ GMail inbox, my ğŸ“ƒ Google Docs link. what I didnâ€™t know is that the conversation is saved conveniently in a top left tab, and you can pin itâ€Šâ€”â€Šuntil youâ€™re done with yourÂ project.</p><p>I paste the JS / HTML code andâ€¦ it works FROM SCRATCH! Teh first tentative works! Wow Iâ€™m impressed. I start putting the <a href="https://github.com/palladius/js-simple-search">code into github</a> for posterity and for making potentially breakingÂ changes.</p><h4>Letâ€™s add complexity. Add a Boolean and multi-parameter search!</h4><p>Prompt2. â€œ<strong><em>Wow! Say I want to do something a bit more complex for example selecting a Boolean (isTechnical=true/false) which is in the frontend as checkbox and in the JSON, and I want to sort the result by some kind of rating? Can you help me add those two functionalities both to html and to JavaScript?â€</em></strong></p><p>Result:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/916/1*LqieYZJOw5dEYrNiyER7pA.png" /><figcaption>The result is impeccableâ€Šâ€”â€Šexcept with the <em>Pasta Primavera</em> which definitely not ğŸ‡®ğŸ‡¹-compliant!</figcaption></figure><p>Note that Bard gives me the index.html code, the script.jscodeÂ , and also a pre-baked JSON which responds to my requirements (a isTechnical boolean and a floatÂ rating).</p><h4>Add little nits: CSS andÂ Cards</h4><p>Prompt 3. <strong>Wow this is amazing! Final thing, can you share a little css snippet to make this look nice and professional? Iâ€™m bad atÂ CSS.</strong></p><p>This made the final visualization a bit better (notÂ much).</p><p>Prompt 4. <strong><em>Fantastic! Last thing. I would like to visualize the search result as nicely formatted cards, think of three rectangles per row, with title description and maybe a small image turned into a square with rounded corners. Can you help me with html andÂ CSS?</em></strong></p><p>And this is the first time Bard makes a mistake. He gives me a HTML code which seems like <a href="https://angular.io/api/common/NgFor">Angular</a> (ngForÂ ):</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/940/1*CsYSrgiS7TedB28Xt-7atw.png" /><figcaption>This is a mistake: `ngFor` only exists in <a href="https://angular.io/api/common/NgFor">Angular</a> framework (I presume?)</figcaption></figure><h4>Result</h4><p>The app is currently served by cloud run here: <a href="https://js-simple-search-bsl7ylv4hq-ew.a.run.app/">https://js-simple-search-bsl7ylv4hq-ew.a.run.app/</a></p><p>This is the final result in GIFÂ format:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*D8xzbhzjBKZkjsvU.gif" /></figure><p>The functionalities it demonstrates are:</p><ul><li>responsive sub-JSON search function (every letter triggers a search on <em>Title</em> or <em>Description</em>)</li><li>boolean selection (isTechnical orÂ not)</li><li>Sort by <em>rating</em> (number) or by <em>Title</em>Â (string)</li></ul><h4>Conclusions</h4><p>As a person who canâ€™t even code a strlen() in Javascript, I was able to create a simple / dumbâ€Šâ€”â€Šyet customizedâ€Šâ€”â€Šwebsite <strong>within an hour</strong> on a Saturday afternoon (when my wife was babysitting).</p><p><a href="https://bard.google.com/">bard.google.com</a> gave me good code from the beginning, and responded correctly to the next 2 questions. The first error was at the 4th prompt (!). Also, on the negatives, the CSS for cards was pretty ugly so I had to fix it myself (luckily I speak some rudimental <a href="https://getbootstrap.com/docs/4.0/components/card/">Boostrap</a>).</p><p>I found Bard can be a pretty good companion if you have time to kill away from keyboard, and you want to go with the flow in some brainstorming phase, ready to copy the content when youâ€™re back to your workstation.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=b2585e55385e" width="1" height="1" alt="">]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Insights on Medium articles with GenAI and Ruby!]]></title>
            <link>https://blog.devops.dev/parse-medium-articles-with-genai-and-add-some-fun-02fe9d30475a?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/02fe9d30475a</guid>
            <category><![CDATA[vertex-ai]]></category>
            <category><![CDATA[google-cloud-platform]]></category>
            <category><![CDATA[medium]]></category>
            <category><![CDATA[ruby]]></category>
            <category><![CDATA[genai]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Thu, 16 Nov 2023 13:54:40 GMT</pubDate>
            <atom:updated>2023-11-22T18:34:15.863Z</atom:updated>
            <content:encoded><![CDATA[<h3>Automated insights on Medium articles with GenAI andÂ Ruby!</h3><p>A few months ago my manager asked me to ramp up on GenAI. That was one of the best work days of my life! Google offers a lot of toys to play with, and itâ€™s hard not to have fun. Iâ€™m fortunate enough to have a job I really love! But enough with my dramatic style, since <a href="https://cloud.google.com/vertex-ai/docs/generative-ai/start/quickstarts/api-quickstart"><strong>Vertex AI </strong></a>Palm API seems to think iâ€™m a bit too Italian,Â look:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*wnUNrC0-Mg0j5Hef0kJXqQ.png" /><figcaption><strong>â€œRiccardo has a flair for the dramaticâ€: </strong>Palm API seems to have a sense ofÂ humour!</figcaption></figure><p>This article will illustrate how to crawl someoneâ€™s Medium page, and use GenAI to build a JSON file which has a mix of the crawled information and some new information which Vertex AIâ€™s text-bison was able to infer forÂ us.</p><h4>The code</h4><p><strong>TL;DR</strong> If you want to delve into the code: <a href="https://github.com/palladius/genai-googlecloud-scripts/tree/main/03-ruby-medium-article-slurper">https://github.com/palladius/genai-googlecloud-scripts/tree/main/03-ruby-medium-article-slurper</a></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/949/0*Nq7afPB21pYiBnx5" /><figcaption>A Ruby crawler to find insights on MediumÂ Articles</figcaption></figure><p>A Ruby crawler to find insights on Medium ArticlesMy script is simple: you give it a Medium handle (mine is â€œ<em>palladiusbontonâ€</em>) and it will do twoÂ things:</p><ol><li>Parse the XML RSS feed from Medium (thanks for making it <em>curl</em>-able!) which provides a list of the latest (10?) articles by that person. [<a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/03-ruby-medium-article-slurper/inputs/medium-feed.palladiusbonton.xml">example</a>]</li><li>Extract some significant fields (title, body, date, keywords,Â ..) [<a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/03-ruby-medium-article-slurper/inputs/medium-latest-articles.palladiusbonton.txt">example</a>]</li><li>Paste those at the end of a convoluted <a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/03-ruby-medium-article-slurper/main.rb#L34-L93">GenAIÂ <strong>prompt</strong></a>.</li><li>Call the <strong>Vertex AI</strong> Palm API to get an answer.Â [<a href="https://github.com/palladius/genai-googlecloud-scripts/blob/main/03-ruby-medium-article-slurper/outputs/medium-latest-articles.palladiusbonton.txt.json">sample</a>]</li></ol><p>What am I trying to prove? Iâ€™m trying to use an LLM for a fewÂ things:</p><ul><li><strong>Data Scraping.</strong> I can do this also in a deterministic way (with <a href="https://nokogiri.org/index.html">nokogiri</a>).</li><li><strong>Classification</strong>. Iâ€™m really playing with this a lot. I ask the system to <strong>rate</strong> articles from 1 to 10, and to tell whether theyâ€™re Google Cloud articles or not. I also ask it to infer authorâ€™s <strong>nationality</strong> and <strong>favorite languages.</strong></li><li><strong>Summarization</strong>. I get a small summary of each article, which is superÂ useful.</li></ul><h4>Two prompts: Text andÂ JSON</h4><p>This morning, my prompt looked likeÂ this:</p><pre>Prompt = &lt;&lt;-END_OF_PROMPT<br>Provide a summary for each of the following articles.<br><br>* Please write about the topics, the style, and rate the article from 1 to 10 in terms of accuracy or professionalism.<br>* Please also tell me, for each article, whether it talks about Google Cloud.<br>* Can you guess the nationality of the person (or geographic context of the article itself) writing all of these articles?<br>* If you can find any typos or visible mistakes, please write them down.<br><br>--<br><br>#{Medium content will be pasted here}<br><br>END_OF_PROMPT</pre><p>My colleague Marc C has showed me that genAI can do betterâ€Šâ€”â€Šit can write a JSON for you, with very little guidance! Actually itâ€™s probably better than a human to close parenthesis and double quotesÂ :)</p><p>So after 3â€“4 hours of tinkering I got to thisÂ version:</p><pre><br>### PROMPT HISTORY<br># 1.6 16nov23 Removed typos from articles.<br># 1.5 16nov23 Added movie.<br># 1.4 16nov23 M oved from TXT to JSON!<br><br>PromptInJson = &lt;&lt;-END_OF_PROMPT<br>You are an avid article reader and summarizer. I&#39;m going to provide a list of articles for a single person and ask you to do this:<br><br>1. For each article, I&#39;m going to ask a number of per-article questions<br>2. Overall, I&#39;m going to ask questions about the author.<br><br>I&#39;m going to provide a JSON structure for the questions I ask. If you don&#39;t know some answer, feel free to leave NULL/empty values.<br><br>1. Per-article:<br><br>* Please write about the topics, the style, and rate the article from 1 to 10 in terms of accuracy or professionalism.<br>* Please also tell me, for each article, whether it talks about Google Cloud.<br>* For each article, capture the original title and please produce a short 300-500-character summary.<br>* What existing movie or book would this article remind you the most of? Try a guess, use your fantasy.<br><br>2. Overall (author):<br><br>* Extract name and surname<br>* Can you guess the nationality of the person (or geographic context of the article itself) writing all of these articles?<br>* Please describe this author style. Is it professional or more personal? Terse or verbose? ..<br>* Does this author prefer a certain language? In which language are their code snippets (if any)?<br>* If you can find any typos or recurring mistakes in any article, please write them here.<br><br>Please provide the output in a `JSON` file as an array of answer per article, like this:<br><br>{<br>    &quot;prompt_version&quot;: &quot;1.6a&quot;, // do NOT change this, take verbatim<br>    &quot;author_name&quot;: &quot;&quot;, // name and surname of the author<br>    &quot;author_nationality&quot;:  &quot;&quot;, // nationality here<br>    &quot;author_style&quot;: &quot;&quot;,  // overall author style: is it professional or more personal? Terse or verbose? ..<br>    &quot;author_favorite_languages&quot;: &quot;&quot;,  // which languages does the author use? Pascal? C++? Python? Java? Usa comma separated for the list.<br>    &quot;typos&quot;: [{ // array of mistakes or typos<br>            &quot;current&quot;: &quot;xxx&quot;, // typo or mistake<br>            &quot;correct&quot;: &quot;yyy&quot;,  // <br>        }],<br>    &quot;articles_feedback&quot;: [<br><br>        // article 1<br>        {<br>        &quot;title&quot;: &quot;&quot;,         // This should be the ORIGINAL article title, you should be able to extract it from the TITLE XML part, like &quot;&lt;title&gt;&lt;![CDATA[What is toilet papers right side?]]&gt;&lt;/title&gt;&quot;<br>        &quot;summary&quot;: &quot;...&quot;,    // This should be the article summary produced by you.<br>        &quot;publication_date&quot;: &quot;&quot; // This should be provided to you in input<br>        &quot;accuracy&quot;: XXX,     // Integer 1 to 10<br>        &quot;is_gcp&quot;:   false,   // boolean, true of false<br>        &quot;movie_or_book&quot;: &quot;&quot;   // string, a book or film this article content reminds you of.<br>        ] <br>    },<br><br>        // Article 2, and so on..<br>    ]<br>}<br><br>Make **ABSOLUTELY SURE** the result is valid JSON or I&#39;ll have to drop the result.<br><br>Here are the articles:<br><br>--<br><br>END_OF_PROMPT</pre><p>Iâ€™ve been playing around with the structure a lot: what pertains to the single article, what with the global part (author identity /Â style)?</p><h4>Hey, we want someÂ action!</h4><p>Sure, here you are! Letâ€™s look setp by step the output from the <strong>Ruby crawler </strong>and comment onÂ it:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/949/0*k25ajaAGq6ruaS2O" /><figcaption>Typical Ruby crawler, inÂ Nokogiri</figcaption></figure><h4>Phase 1â€Šâ€”â€Šdownload theÂ XML.</h4><p>First, curl this XML: <a href="https://medium.com/feed/@palladiusbonton">https://medium.com/feed/@palladiusbonton</a>Â . Results looks likeÂ this:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/608/1*1TOI6AooifViF0eP-0YbkA.png" /><figcaption>Zooming on a single article (XML RSSÂ Feed)</figcaption></figure><p>XML looks like this, so far soÂ good.</p><h4>Phase 2â€Šâ€”â€Špsarse the XML wityhÂ Nokogiri</h4><p>For each item, I scrape things I care about. Probably I could have it just infer automatically, but itâ€™s little effort, so why not! Iâ€™t just about finding the fields you careÂ about:</p><ul><li>iterate throughÂ item</li><li>Per item, extract what you want: titleÂ , dc:creator, linkÂ , pubDateÂ ,Â ..</li></ul><p>The heavy lifting is done by <a href="https://nokogiri.org/index.html">nokogiri</a>, which is a <strong>real ğŸ’</strong> gem among Ruby gems; no, itâ€™s not a repetition, itâ€™s just a double gem. Pythonists and Javascriptists, I wish you had it in your language tooÂ ğŸ˜œ</p><pre># Code: https://github.com/palladius/genai-googlecloud-scripts/blob/main/03-ruby-medium-article-slurper/main.rb#L120-L141<br>File.open(genai_input_filename, &#39;w&#39;) do |file| # file.write(&quot;your text&quot;) }<br>        ## Version 2: Scrape more important metadatsa<br>        docSM.xpath(&quot;//item&quot;).each_with_index do |node,ix| # Article<br>            file.writeln &quot;\n====== Article #{ix+1} =====&quot;<br>            title = node.xpath(&quot;title&quot;).inner_text<br>            creator = node.xpath(&quot;dc:creator&quot;).inner_text<br>            url =  node.xpath(&quot;link&quot;).inner_text<br>            pubDate =  node.xpath(&quot;pubDate&quot;).inner_text<br>            categories =  node.xpath(&quot;category&quot;).map{|c| c.inner_text}  # there&#39;s many, eg:  [&quot;cycling&quot;, &quot;google-forms&quot;, &quot;data-studio&quot;, &quot;pivot&quot;, &quot;google-sheets&quot;]<br>            article_content = ActionView::Base.full_sanitizer.sanitize(node.inner_text)<br>            file.writeln &quot;* Title: &#39;#{title}&#39;&quot;<br>            file.writeln &quot;* Author: &#39;#{creator}&#39;&quot;<br>            file.writeln &quot;* URL: &#39;#{url}&#39;&quot;<br>            file.writeln &quot;* PublicationDate: &#39;#{pubDate}&#39;&quot;<br>            file.writeln &quot;* Categories: #{categories.join(&#39;, &#39;)}&quot;<br>            file.writeln &quot;&quot;<br>            file.writeln article_content<br>        end<br>end</pre><p>Result of this part of the code looks likeÂ this:</p><pre>====== Article 3 =====<br>* Title: &#39;Migrate GCP projects across organizations, the gcloud way&#39;<br>* Author: &#39;Riccardo Carlesso&#39;<br>* URL: &#39;https://medium.com/google-cloud/how-to-migrate-projects-across-organizations-c7e254ab90af?source=rss-b5293b96912f------2&#39;<br>* PublicationDate: &#39;Tue, 18 Apr 2023 13:16:26 GMT&#39;<br>* Categories: gcp-security-operations, google-cloud-platform, migration<br><br><br>            [...]<br>            Nel mezzo del cammin di nostra vita, mi ritrovai per una selva oscura, chÃ© la diritta via era smarritaâ€â€” Dante Alighieri(*), Divine Comedy(*) the Italian version of Shakespeare, </pre><h4>Phase 3â€Šâ€”â€ŠGet LLM to infer information and spark someÂ humour</h4><p>If this was a deterministic program we could just end here: I have all the info, Iâ€™m basically translating from XML to JSON. Not majorlyÂ useful.</p><p>Iâ€™ll use GenAI to add some colorÂ here:</p><ul><li><strong>Infer</strong> author <strong>nationality</strong>,<strong> favorite languages</strong> and <strong>writingÂ style</strong>.</li><li>Per article, write a small summary, infer accuracy and if itâ€™s a GCP article or not. There you go, <strong>we have a rudimental QA tester and a classifier</strong>!â€Šâ€”â€ŠwOOOt!Â ğŸ˜®</li></ul><p>For my buddy Romin I getÂ this:</p><pre>{   &quot;prompt_version&quot;: &quot;1.6b&quot;,<br>    &quot;author_name&quot;: &quot;Romin Irani&quot;,<br>    &quot;author_nationality&quot;: null,<br>    &quot;author_style&quot;: &quot;verbose, professional&quot;,<br>    &quot;author_favorite_languages&quot;: &quot;Python, Java&quot;,<br>    &quot;typos&quot;: [<br>        {<br>            &quot;current&quot;: &quot;criterias&quot;,<br>            &quot;correct&quot;: &quot;criteria&quot;<br>        }<br>    ],<br>    &quot;articles_feedback&quot;: [<br>        {<br>            &quot;title&quot;: &quot;Integrating langchain4j and PaLM 2 Chat Bison Model&quot;,<br>            &quot;summary&quot;: &quot;The article describes how to integrate Langchain4j and PaLM 2 Chat Bison Model. It provides detailed instructions on how to set up the environment, create a Google Cloud Function, and deploy the model. The article also includes a code sample and a link to the GitHub repository.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/google-cloud/integrating-langchain4j-and-palm-2-chat-bison-model-a684cefd67af?source=rss-802a4d428d95------2&quot;,<br>            &quot;publication_date&quot;: &quot;Mon, 06 Nov 2023 11:01:02 GMT&quot;,<br>            &quot;accuracy&quot;: 9,<br>            &quot;is_gcp&quot;: true,<br>            &quot;movie_or_book&quot;: null<br>        },<br>        {<br>            &quot;title&quot;: &quot;Google Cloud Platform Technology Nuggets \u2014 October 15\u201331, 2023 Edition&quot;,<br>            &quot;summary&quot;: &quot;The article provides a summary of Google Cloud Platform Technology Nuggets for the period of October 15-31, 2023. It covers topics such as infrastructure, containers and Kubernetes, identity and security, networking, machine learning, storage, databases and data analytics, and developers and practitioners.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/google-cloud/google-cloud-platform-technology-nuggets-october-15-31-2023-edition-4d5ea0689e30?source=rss-802a4d428d95------2&quot;,<br>            &quot;publication_date&quot;: &quot;Tue, 31 Oct 2023 10:22:07 GMT&quot;,<br>            &quot;accuracy&quot;: 8,<br>            &quot;is_gcp&quot;: true,<br>            &quot;movie_or_book&quot;: null<br>        },<br>        {<br>            &quot;title&quot;: &quot;Develop a FlutterFlow App powered by Vertex AI PaLM 2 Integration&quot;,<br>            &quot;summary&quot;: &quot;The article describes how to integrate FlutterFlow with Vertex AI PaLM 2. It provides a step-by-step guide on how to set up the environment, create a Google Cloud Function, and deploy the model. The article also includes a code sample and a link to the GitHub repository.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/google-cloud/flutterflow-and-vertex-ai-palm-2-integration-14c137e83053?source=rss-802a4d428d95------2&quot;,<br>            &quot;publication_date&quot;: &quot;Thu, 26 Oct 2023 09:37:11 GMT&quot;,<br>            &quot;accuracy&quot;: 8,<br>            &quot;is_gcp&quot;: true,<br>            &quot;movie_or_book&quot;: null<br>        }<br>    ]<br>}</pre><p>For my buddy Guillaume I getÂ this:</p><pre>{   &quot;prompt_version&quot;: &quot;1.6b&quot;,<br>    &quot;author_name&quot;: &quot;Guillaume Laforge&quot;,<br>    &quot;author_nationality&quot;: &quot;French&quot;,<br>    &quot;author_style&quot;: &quot;Guillaume Laforge&#39;s writing style can be described as professional, informative, and engaging. He often writes about technology, open-source software, and programming.&quot;,<br>    &quot;author_favorite_languages&quot;: &quot;Java, Python&quot;,<br>    &quot;articles_feedback&quot;: [<br>        {<br>            &quot;title&quot;: &quot;Tech Watch #4 \u2014 October, 27, 2023&quot;,<br>            &quot;summary&quot;: &quot;The article provides a summary of the latest developments in the field of artificial intelligence (AI). It covers topics such as the use of LLMs in vector embeddings, the scheduling of PostgreSQL tasks with pg_cron, and the creation of maps with Protomaps. The article also includes links to the original sources for further reading.&quot;,<br>            &quot;url&quot;: &quot;https://glaforge.medium.com/tech-watch-4-october-27-2023-d48a1449eeb0?source=rss-431147437aeb------2&quot;,<br>            &quot;publication_date&quot;: &quot;Fri, 27 Oct 2023 15:04:58 GMT&quot;,<br>            &quot;accuracy&quot;: 8,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;The Matrix&quot;<br>        },<br>        {<br>            &quot;title&quot;: &quot;Tech Watch #3 \u2014 October, 20, 2023&quot;,<br>            &quot;summary&quot;: &quot;The article provides a summary of the latest developments in the field of technology. It covers topics such as the use of Groovy in 2023, the state of WebAssembly in 2023, and the use of large language models (LLMs) to solve logic problems. The article also includes links to the original sources for further reading.&quot;,<br>            &quot;url&quot;: &quot;https://glaforge.medium.com/tech-watch-3-october-20-2023-11a70245017d?source=rss-431147437aeb------2&quot;,<br>            &quot;publication_date&quot;: &quot;Fri, 20 Oct 2023 19:49:34 GMT&quot;,<br>            &quot;accuracy&quot;: 9,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;2001: A Space Odyssey&quot;<br>        },<br>        {<br>            &quot;title&quot;: &quot;Client-side consumption of a rate-limited API in Java&quot;,<br>            &quot;summary&quot;: &quot;The article discusses different approaches for consuming rate-limited APIs in Java. It covers topics such as using exponential backoff and jitter, scheduled execution, and using the Bucket4J library. The article also includes code examples for each approach.&quot;,<br>            &quot;url&quot;: &quot;https://glaforge.medium.com/client-side-consumption-of-a-rate-limited-api-in-java-9fbf08673791?source=rss-431147437aeb------2&quot;,<br>            &quot;publication_date&quot;: &quot;Mon, 02 Oct 2023 00:00:53 GMT&quot;,<br>            &quot;accuracy&quot;: 10,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;The Imitation Game&quot;<br>        },<br>        {<br>            &quot;title&quot;: &quot;Tech Watch #1 \u2014 Sept 29, 2023&quot;,<br>            &quot;summary&quot;: &quot;The article provides a summary of the latest developments in the field of technology. It covers topics such as observability-driven development for LLMs, rebuilding LLM documentation chatbots, container security, and the future of databases. The article also includes links to the original sources for further reading.&quot;,<br>            &quot;url&quot;: &quot;https://glaforge.medium.com/tech-watch-1-sept-29-2023-2ac0a3a5016c?source=rss-431147437aeb------2&quot;,<br>            &quot;publication_date&quot;: &quot;Fri, 29 Sep 2023 00:00:11 GMT&quot;,<br>            &quot;accuracy&quot;: 7,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;Minority Report&quot;<br>        }<br>    ]<br>}</pre><p>For myself I get something likeÂ this:</p><pre>{   &quot;prompt_version&quot;: &quot;1.6b&quot;,<br>    &quot;author_name&quot;: &quot;Riccardo Carlesso&quot;,<br>    &quot;author_nationality&quot;: &quot;Italian&quot;,<br>    &quot;author_style&quot;: &quot;Verbose, uses personal anecdotes.&quot;,<br>    &quot;author_favorite_languages&quot;: &quot;Ruby&quot;,<br>    &quot;articles_feedback&quot;: [<br>        {<br>            &quot;title&quot;: &quot;What is toilet paper\u2019s right side?&quot;,<br>            &quot;summary&quot;: &quot;The author discusses the question of which side of toilet paper is the \u201cright\u201d side. They explore the different opinions on this topic and provide their own thoughts on the matter. Ultimately, they conclude that there is no definitive answer to this question and that it is up to each individual to decide which side they prefer.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/@palladiusbonton/what-is-toilet-papers-right-side-8da0504d6d0b?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Tue, 08 Aug 2023 16:37:20 GMT&quot;,<br>            &quot;accuracy&quot;: 8,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: null<br>        },<br>        {<br>            &quot;title&quot;: &quot;Spaghetti Bolognese don\u2019t exist!!1!&quot;,<br>            &quot;summary&quot;: &quot;The author discusses the common misconception that spaghetti Bolognese is an Italian dish. They explain that this dish is actually not from Italy and that it is not considered to be a traditional Italian dish. They also provide some tips on how to make a more authentic Italian pasta dish.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/@palladiusbonton/spaghetti-bolognese-dont-exist-1-2088d85909dd?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Fri, 21 Apr 2023 16:09:23 GMT&quot;,<br>            &quot;accuracy&quot;: 9,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: null<br>        },<br>        {<br>            &quot;title&quot;: &quot;Migrate GCP projects across organizations, the gcloud way&quot;,<br>            &quot;summary&quot;: &quot;The author provides a detailed guide on how to migrate GCP projects across organizations using the gcloud command-line tool. They cover everything from setting up the necessary permissions to executing the migration. This article is a valuable resource for anyone who needs to migrate GCP projects across organizations.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/google-cloud/how-to-migrate-projects-across-organizations-c7e254ab90af?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Tue, 18 Apr 2023 13:16:26 GMT&quot;,<br>            &quot;accuracy&quot;: 10,<br>            &quot;is_gcp&quot;: true,<br>            &quot;movie_or_book&quot;: null<br>}]}</pre><h4>Lessons learnt</h4><p>Today I learnt a fewÂ things:</p><ul><li>For the first time the<strong> token limitation</strong> was visible to me. Palm APIâ€™s text-bisonmodel has a 32k-token limit, and what I didnâ€™t know is that it seems shared between input and output. If I increase the input size, this diminishes the output size (still to be confirmed, for the moment itâ€™s just a hunch). For this reason I reduce my input from 32k to 22k. To see Token Count, Google gives you a <a href="https://cloud.google.com/vertex-ai/docs/generative-ai/get-token-count?hl=en">nice API to calculate it</a> (thanks Guillaume). You can see this very well from the API return JSON (note the sum of thetotalTokens here is exactly the maximum,Â <strong>8192</strong>):</li></ul><pre>&quot;metadata&quot;: {<br>    &quot;tokenMetadata&quot;: {<br>      &quot;outputTokenCount&quot;: {<br>        &quot;totalTokens&quot;: 549,<br>        &quot;totalBillableCharacters&quot;: 1312<br>      },<br>      &quot;inputTokenCount&quot;: {<br>        &quot;totalBillableCharacters&quot;: 20713,<br>        &quot;totalTokens&quot;: 7643<br>      }<br>    }<br>  }</pre><ul><li><strong>Prompting</strong> is a (long) fine-tuning <strong>feedback loop</strong>: you try something out, and after a few answers you realize it doesnâ€™t work, so you try to â€˜bribeâ€™ your model saying to â€œplease do something as itâ€™s very important to youâ€. Example: the movie or book is always empty, itâ€™s probably a stretch for a 0.1 temperature API invocation. So I change â€œ<em>What existing movie or book would this article remind you the most of? Try a guess, use your fantasy</em>â€ by adding â€œ<em>Please do NOT leave this null! Itâ€™s just for fun. yet its very important to me</em>â€. Note that doesnâ€™t fixâ€Šâ€”â€Šoutput gets â€œNoneâ€ instead of null, which is fun. But readÂ onâ€¦</li><li><strong>Temperature is an important parameter. W</strong>hen tasked to infer a title name for my articles, it would refuse, until I raised the temperature from 0.1 to 0.3. Now I get a curious result: my <strong>films</strong> are finally there! Waitâ€Šâ€”â€Š<em>Ratatouille</em>, seriously?</li></ul><pre>{<br>    &quot;prompt_version&quot;: &quot;1.6b&quot;,<br>    &quot;author_name&quot;: &quot;Riccardo Carlesso&quot;,<br>    &quot;author_nationality&quot;: &quot;Italian&quot;,<br>    &quot;author_style&quot;: &quot;Verbose, uses humor and personal anecdotes. Seems to prefer Ruby on Rails.&quot;,<br>    &quot;author_favorite_languages&quot;: &quot;Ruby&quot;,<br>    &quot;typos&quot;: [<br>        {<br>            &quot;current&quot;: &quot;cis-centralis /pendens&quot;,<br>            &quot;correct&quot;: &quot;cis-centralis/pendens&quot;<br>        },<br>        {<br>            &quot;current&quot;: &quot;trans-centralis/mur\u00e0lis&quot;,<br>            &quot;correct&quot;: &quot;trans-centralis/muralis&quot;<br>        },<br>        {<br>            &quot;current&quot;: &quot;spaghetti Bolognese don\u2019t&quot;,<br>            &quot;correct&quot;: &quot;Spaghetti Bolognese doesn&#39;t&quot;<br>        }<br>    ],<br>    &quot;articles_feedback&quot;: [<br>        {<br>            &quot;title&quot;: &quot;What is toilet paper\u2019s right side?&quot;,<br>            &quot;summary&quot;: &quot;The author discusses the great \&quot;toilet paper orientation debate\&quot; and shares their own experiences and opinions on the matter, ultimately concluding that there is no one right answer.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/@palladiusbonton/what-is-toilet-papers-right-side-8da0504d6d0b?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Tue, 08 Aug 2023 16:37:20 GMT&quot;,<br>            &quot;accuracy&quot;: 8,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;The Big Lebowski&quot;<br>        },<br>        {<br>            &quot;title&quot;: &quot;Spaghetti Bolognese don\u2019t exist!!1!&quot;,<br>            &quot;summary&quot;: &quot;The author argues that the popular dish \&quot;Spaghetti Bolognese\&quot; does not exist in Italy and is considered an \&quot;imaginary dish\&quot; by Italians. They explain that the traditional Italian dish is called \&quot;rag\u00f9 alla bolognese\&quot; and is typically served with tagliatelle or other types of pasta, not spaghetti.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/@palladiusbonton/spaghetti-bolognese-dont-exist-1-2088d85909dd?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Fri, 21 Apr 2023 16:09:23 GMT&quot;,<br>            &quot;accuracy&quot;: 9,<br>            &quot;is_gcp&quot;: false,<br>            &quot;movie_or_book&quot;: &quot;Ratatouille&quot;<br>        },<br>        {<br>            &quot;title&quot;: &quot;Migrate GCP projects across organizations, the gcloud way&quot;,<br>            &quot;summary&quot;: &quot;The author provides a detailed guide on how to migrate GCP projects across organizations using the gcloud command-line tool. They cover topics such as identifying the current state of the projects, managing IAM permissions, and handling special cases.&quot;,<br>            &quot;url&quot;: &quot;https://medium.com/google-cloud/how-to-migrate-projects-across-organizations-c7e254ab90af?source=rss-b5293b96912f------2&quot;,<br>            &quot;publication_date&quot;: &quot;Tue, 18 Apr 2023 13:16:26 GMT&quot;,<br>            &quot;accuracy&quot;: 10,<br>            &quot;is_gcp&quot;: true,<br>            &quot;movie_or_book&quot;: &quot;The Matrix&quot;<br>        }<br>    ]<br>}</pre><ul><li>Finally, asking an LLM to create JSON or YAML can really speed up your development time, you can create <a href="https://api.rubyonrails.org/v3.1/classes/ActiveRecord/Fixtures.html">fixtures</a> for your blog or app, or you can just use a computer to further process an imperfect, half-processed entity.</li></ul><h3>Conclusions</h3><p>LLMs are a really powerful tool to read long quantities of text, summarize them and classify them based on yourÂ tastes.</p><p>It can provide structured output (eg JSON) which you can in turn parse and use to populate a DB and an app. This way, a <strong>recommendation engine</strong> for your favourite articles (eg GCP articles, sorted by date of accuracy ) becomes easy and fun toÂ build!</p><h4>Next Steps</h4><p>How could I extend thisÂ project?</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/949/0*uCKwk5OiCddNrioH" /></figure><ol><li>Add a workflow, possibly with <a href="https://cloud.google.com/workflows"><strong>Cloud Workflows</strong></a>. Iterate until Iâ€™m happy with the quality of the outputted JSON.</li><li>Use pre-vetted JSON to populate an easy-peasy Node.JS app, and run it on <a href="https://cloud.google.com/run">CloudÂ Run</a>.</li><li>Change the code to create the â€œMorning list of articles for Riccardo to readâ€, by pulling A LOT of articles and do queries by <strong>keyword</strong> (in this demo itâ€™s â€˜GCPâ€™ but could also bi â€˜Pistacchioâ€™ or â€˜Politicsâ€™).</li><li>sed s/keyword/embeddings/g to make it able to do semanticÂ search.</li></ol><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=02fe9d30475a" width="1" height="1" alt=""><hr><p><a href="https://blog.devops.dev/parse-medium-articles-with-genai-and-add-some-fun-02fe9d30475a">Insights on Medium articles with GenAI and Ruby!</a> was originally published in <a href="https://blog.devops.dev">DevOps.dev</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[What is toilet paperâ€™s right side?]]></title>
            <link>https://medium.com/@palladiusbonton/what-is-toilet-papers-right-side-8da0504d6d0b?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/8da0504d6d0b</guid>
            <category><![CDATA[toilet-paper]]></category>
            <category><![CDATA[ruby-on-rails]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Tue, 08 Aug 2023 16:37:20 GMT</pubDate>
            <atom:updated>2023-08-08T16:37:20.531Z</atom:updated>
            <content:encoded><![CDATA[<p>Thereâ€™s very little on this planet as polarizing as â€œthe right position of toilet paperâ€: what I call <em>cis-centralis</em> /<em>pendens</em>, or <em>trans-centralis/</em>murÄlis<em>? </em>(yup, I just made those upâ€Šâ€”â€Šstart googlingÂ ğŸ‘¹).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*APk8AVbLtK9dn6VYwNIv_w.png" /><figcaption>A puffin trying to find the right position to his toiletÂ paper</figcaption></figure><p>As a <a href="https://rubyonrails.org/">Ruby on Rails</a> developer, Iâ€™ve been long interested in <a href="https://en.wikipedia.org/wiki/Convention_over_configuration"><em>Default over Configuration</em></a><em> (and </em><a href="https://en.wikipedia.org/wiki/Principle_of_least_astonishment"><em>POLA</em></a><em>)</em>. What is the default/correct solution? I thought I knew.. until I gotÂ married.</p><pre>myhome:<br>  bath_ricc:<br>    toilet_paper_position: &#39;?!?&#39; # looking for a golden default..<br>  bath_kids:<br>    toilet_paper_position: &#39;?!?&#39; # must clearly be the same golden default!</pre><h4>The officialÂ Solution</h4><p>The inventor of toilet paper patented the solution in 1891 (patent <a href="https://patents.google.com/patent/US459516">US459516</a>, apparently Seth Wheeler was a Googler <em>ante litteram</em>).</p><figure><img alt="Wheeler took good time to describe how to extract the paper, piece by piece. Wow!" src="https://cdn-images-1.medium.com/max/500/0*SR7pztID9FbvgFTr.jpg" /></figure><h4>However..</h4><p>.. Itâ€™s actually more complicated than itÂ looks.</p><p>I have this <em>sheldonic</em> tendency of thinking people disagreeing with me on trivial things being automatically wrong; however, I often stand corrected. This is one of those timesÂ :) After consulting a number of people who disagreed with me, trying to hold my initial disgust in this barbaric act of â€œmuralic paperâ€ (<em>Are you crazy?!? It gets dirty just before touching your butt!</em>) I realized there are cases where that configuration can actually doÂ better.</p><ul><li>If you have a <strong>cat</strong>, the cat will likely like to play with theÂ paper.</li><li>If you have a <strong>son</strong>, say his name is SebastianÂ . I donâ€™t have any experimental proof that a daughter would yield the same results. Please comment to provide further dataÂ points.</li><li>There might be other occasions where this might be true (eg, windy location, gravity working against you, lot of liquid close to the precious paper,Â ..). Please contribute with your own experience.</li></ul><h4>Conclusions</h4><p>In this factious article, I took a dilemma, showed the solution, and then showed that the solution can fail due toÂ .</p><pre># This is the perfect solution which works for my home.<br>my_home:<br>  bath_ricc:<br>    toilet_paper_position: pendens <br>  bath_kids:<br>    toilet_paper_position: muralis</pre><p>I believe after reading this, you will be a more complete human. Youâ€™re welcomeÂ ğŸ¤£</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=8da0504d6d0b" width="1" height="1" alt="">]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Spaghetti Bolognese donâ€™t exist!!1!]]></title>
            <link>https://medium.com/@palladiusbonton/spaghetti-bolognese-dont-exist-1-2088d85909dd?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/2088d85909dd</guid>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Fri, 21 Apr 2023 16:09:23 GMT</pubDate>
            <atom:updated>2023-04-21T16:12:23.239Z</atom:updated>
            <content:encoded><![CDATA[<p><em>(yes, the exclamation marks are correctÂ ğŸ˜‰)</em></p><p><strong>Spaghetti Bolognese</strong>: Everyone knows themâ€¦ except Italians.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/750/0*5ZewLxGd3Yska4Am.jpg" /><figcaption>An imaginary dish,Â .. just like square root of -1, or like a word which doesnâ€™t exist... just uselesser</figcaption></figure><p>Right, read it again if you donâ€™t believe meâ€¦ in Italy we donâ€™t prepare that kind ofÂ pasta.</p><p>What the hell, you may be wonderingâ€¦ Italy is famous for spaghetti <em>and</em> bolognese sauce (that we call â€œragÃ¹<em> alla bolognese</em>â€ or simply ragÃ¹<em>, (from </em><a href="https://en.wikipedia.org/wiki/Ragout"><strong><em>r</em>agoÃ»t</strong></a>), but we would never mix these two things in the sameÂ dish).</p><p>Why oh why, you may as well think? I think the reason can be found in twoÂ ways.</p><p>First, they come from two different cultures. Spaghetti come from the south, where a simpler tomato, basil, and veg sauce would seem more appropriate.</p><p>Second, spaghetti are slippery, so theyâ€™re not as good to â€˜retainâ€™ a demanding sauce as a beef ragÃ¹ is. As every bolognese person can tell you, appropriate pastas for bolognese ragÃ¹ can be: tagliatelle (first choice), pennette/penne/mezzepenne, conchiglie, fusilli, maccheroni,Â â€¦ in general every form of â€˜<strong>pasta rigata</strong>â€™ (<em>ribbed pasta</em>). Pasta rigata is a pasta that is not smooth, so thas sauce is more likely to stay with the pasta, instead of slipping down. I think the main reason why every person from Bologna is horrified by the mere idea of associating spaghetti with our proud ragÃƒÂ¹ is that we perfectly know (because everyone has made that mistake once in their life) what happens if you do that: spaghetti would ruthlessly come up your fork completely naked of any red or meaty traceâ€¦ just to leave a gloomy surprise in the very end: a bloody pool of meat and tomato just looking at you as if asking â€œNow what?â€. And unless you are Italian, you donâ€™t know what scarpetta is. but thatâ€™s anotherÂ story.</p><h4>What does wikipedia say?</h4><p>As Wikipedia (as of 19dec09) says about <a href="http://en.wikipedia.org/wiki/Bolognese_sauce">Bolognese_sauce</a>:</p><p><em>[â€¦] </em>Bolognese sauce known in Italian as <strong>ragÃ¹ alla bolognese</strong>, pronounced [, ragÃ¹ bolognese, or simply ragÃ¹) is a meat-based sauce in Italian cuisine, typical of the city of Bologna. It is customarily used to dress tagliatelle al ragÃ¹ and to prepare lasagne alla bolognese.</p><p>Italian ragÃ¹ alla bolognese is a slowly cooked meat-based sauce, and its preparation involves several techniques, including sweating, sautÃ©ing and braising. Ingredients include a characteristic soffritto of onion, celery and carrot, different types of minced or finely chopped beef, often alongside small amounts of fatty pork. White wine, milk, and a small amount of tomato paste or tomatoes are added, and the dish is then gently simmered at length to produce a thickÂ sauce.</p><p>Outside Italy, the phrase â€œBolognese sauceâ€ is often used to refer to a tomato-based sauce to which minced meat has been added; such sauces typically bear little resemblance to the Italian ragÃ¹ alla bolognese, being more similar in fact to the ragÃ¹ alla napoletana from the tomato-rich south of the country. Although in Italy ragÃ¹ alla bolognese is not used with spaghetti (but rather with flat pasta, like tagliatelle),[2][3][4] so-called â€œspaghetti bologneseâ€ has become a popular dish in many other parts of the world.[where</p><h4>Iâ€™m not Italian: what can we do toÂ comply?</h4><p>If you werenâ€™t born with the privilege of ğŸ‡®ğŸ‡¹ Italianity, Iâ€™ve built a software for you to teach you the proper <em>abbinamenti</em> (couplings) between <strong>pastas</strong> andÂ <strong>sauces</strong>.</p><p>Itâ€™s simple, install my app from github: <a href="https://github.com/palladius/pasta">https://github.com/palladius/pasta</a></p><p>Itâ€™s written in Ruby on Rails (of course), itâ€™s fully Dockerized, and features a beautiful matrix of pastas/sauces:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*kfAypJ0sBgMh2UKu.png" /></figure><p>The code which defined good condiments is <a href="https://github.com/palladius/pasta/blob/master/db/seeds.rb#L75-L100">here</a>, under <a href="https://github.com/palladius/pasta/blob/master/db/seeds.rb#L75-L100">db/seeds.rb</a>Â .</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=2088d85909dd" width="1" height="1" alt="">]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Migrate â˜ï¸ GCP projects across organizations, with gcloud]]></title>
            <link>https://medium.com/google-cloud/how-to-migrate-projects-across-organizations-c7e254ab90af?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/c7e254ab90af</guid>
            <category><![CDATA[gcp-security-operations]]></category>
            <category><![CDATA[google-cloud-platform]]></category>
            <category><![CDATA[migration]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Tue, 18 Apr 2023 13:16:26 GMT</pubDate>
            <atom:updated>2023-11-20T15:04:31.008Z</atom:updated>
            <content:encoded><![CDATA[<p><em>Nel mezzo del cammin di nostra vita, <br>mi ritrovai per una selva oscura, <br>chÃ© la diritta via era smarritaâ€</em></p><p><em>â€” </em>Dante Alighieri(*), <a href="https://en.wikipedia.org/wiki/Divine_Comedy">DivineÂ Comedy</a></p><p><em>(*) the Italian version of Shakespeare, justÂ better</em></p><p>Translated for non-ğŸ‡®ğŸ‡¹: some day I was encouraged by some external entity to move a lot of projects from 5 of my organizations (<em>source</em>) to another organization (<em>destination</em>).</p><p><strong>TL;DR</strong> If you find this article too long and you want to jump to the code, click on <a href="https://gist.github.com/palladius/a99993feb7e6d78b7a2abea0a10c3242">this </a>ğŸ™ğŸ˜º<a href="https://gist.github.com/palladius/a99993feb7e6d78b7a2abea0a10c3242">Â gist</a>.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/974/1*Hl8tr6N3VrV_AGItbPb25w.jpeg" /><figcaption>My two boys in front of <a href="https://en.wikipedia.org/wiki/The_Gates_of_Hell">The Gates of Hell</a>, MusÃ©e Rodin, Paris,Â 2022.</figcaption></figure><p>Since Iâ€™m the best kind of Software Engineer<em>â€Š</em>â€”â€Šthe bad coder but <em>lazy</em> kind ğŸŒâ€Šâ€”â€ŠI decided to script all my move and document for posterity. Also showing you the mistakes I found along the way might be helpful (maybe?).</p><p>This is explained in this GCP page(s): <a href="https://cloud.google.com/resource-manager/docs/project-migration?hl=en">https://cloud.google.com/resource-manager/docs/project-migration</a></p><p>Please remember to dump your current IAM config for the 2+ organisations in case you want to recreate the previous config you just changed. Having a local JSON config for your Org is always a good thing to do. ğŸ˜‰ For instance:</p><pre>$ gcloud alpha organizations get-iam-policy $ORG_ID \<br> - format json &gt; out/org-$DOMAIN-iam.json</pre><p>You can also add specific policies you care about (see below why this is important):</p><pre>$ gcloud resource-manager org-policies describe constraints/iam.allowedPolicyMemberDomains \<br> --organization $ORG_ID | tee -a out/org-$DOMAIN-policies.log</pre><h3>Know the current state of theÂ world</h3><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*FZLcKhtiWl7OqL0w" /></figure><p>You need to know the state of the world (<em>your </em>world). The best way for me to understand where I stand isÂ this:</p><ul><li>Use this awesome repo <a href="https://github.com/palladius/org-folder-projects-graph">https://github.com/palladius/org-folder-projects-graph</a> I wrote a few years ago. <br><strong>Note</strong>: It launches gcloudonce per folder, itâ€™s super-<strong>inefficient</strong> (uses bash over APIs), but has the nice aspect that it keeps all JSON from gcloud locally. This is a big plus in every case except today: â–¶ï¸ after the move you might need a make cache-clean before re-launching it.</li><li>Launch the script for one Org. SampleÂ output:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/477/0*-tHXIe3qGfvvxZfx" /><figcaption>Output from an Org dump script written by anÂ Italian</figcaption></figure><p>If you donâ€™t care about the folder structure at all, a simpler way is to just invoke something likeÂ this:</p><pre># Option 1: Flat structure (simple)<br>$ gcloud projects list - filter \<br>  &quot;parent.id=$ORG_ID AND parent.type=organization&quot;</pre><p>For example:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/861/0*zwm-PDduGYEb60X4" /><figcaption>flat taxonomy fromÂ script1</figcaption></figure><p>Note this wonâ€™t work if you have a complex hierarchy, which is why you probably want to use my script to get all the ramification of yourÂ org.</p><p>You can also play with <a href="https://cloud.google.com/asset-inventory/docs/overview"><strong>GCP Asset Inventory</strong></a> (see great <a href="https://stackoverflow.com/questions/61244749/how-to-list-all-projects-in-gcp-that-belongs-to-a-specific-organization">stackoverflow</a> tip) to get the list <em>without</em> the ğŸ• pizza slices, but youâ€™d be sadder ğŸ˜«Â , Iâ€™mÂ sure.</p><pre># Option 2: Tree structure, with AssetInventory.<br>$ gcloud beta asset search-all-resources \<br>  --asset-types=&#39;cloudresourcemanager.googleapis.com/Project&#39; \<br>  --scope=&quot;organizations/$ORGID&quot; | egrep &#39;^name:&#39; | cut -d/ -f 5</pre><p>Whatever your workflow, Iâ€™m pretty sure youâ€™ll have exceptions, which is why having a spreadsheet (<a href="https://spreadsheet.new/">https://spreadsheet.new/</a> ) will help you big time. I state the source org, destination org, source folder,. source project id, expected destination folder, and notes for my exceptions.</p><p><strong>Please also read this</strong> <a href="https://cloud.google.com/resource-manager/docs/handle-special-cases?hl=en">https://cloud.google.com/resource-manager/docs/handle-special-cases</a> for special cases, like VPC-SC or GCS BucketÂ lock.</p><p>Letâ€™s now find out the IAM state for your org. This is pretty sweet and took me a while to <a href="https://stackoverflow.com/questions/47006062/how-do-i-list-the-roles-associated-with-a-gcp-service-account">research</a> andÂ adapt:</p><pre># Beautiful query which flattens (multiple roles &lt;=&gt; multiple identities).<br>$ gcloud organizations get-iam-policy &quot;$ORG_ID&quot; \<br>  -flatten=&#39;bindings[].members&#39; \<br>  -format=&#39;table(bindings.role,bindings.members)&#39; | <br>  tee &quot;t.org-iam-policy.$ORG_DOMAIN.txt&quot;<br>ROLE MEMBERS<br>[..]<br>roles/billing.admin         group:gcp-billing-admins@example.org<br>roles/billing.admin         user:ricc@example.org<br>roles/billing.creator       domain:example.org<br>roles/browser               group:gcp-billing-admins@example.org<br>roles/cloudasset.owner      user:palladius@example.org<br>roles/cloudasset.owner      user:ricc@example.org<br>roles/orgpolicy.policyAdmin group:gcp-org-administrators@example.org<br>roles/orgpolicy.policyAdmin user:riccardo@example.org<br>roles/resourcemanager.projectCreator user:palladiusbonton@example.org<br>roles/resourcemanager.projectMover   user:ricc@example.org</pre><h3>I donâ€™t want to read the docs: Letâ€™s first try bruteÂ force!</h3><p>I hate it when someone provides me with a working solution and I apply it and donâ€™t know the mystical secrets that led to it. (<em>I invented the half derivative when I was 16, just so you knowâ€Šâ€”â€Šand yes, as you can imagine, itâ€™s useless</em>).</p><p>So letâ€™s try to smash our head over it, one mistake at aÂ time.</p><h3>Error 1Â : â€œThe caller does not have permissionâ€</h3><p>Letâ€™s try it, the command is simpleâ€Šâ€”â€Šbut wonâ€™t work the first 27 times you try it. You have my word. But still, try it. Iâ€™ll use the same ids as in <a href="https://cloud.google.com/resource-manager/docs/configure-org-policy?hl=en">publicÂ docs</a>:</p><pre># Your Org Admin account, and gcloud already working for it:<br>export POWER_ACCOUNT=&#39;my-power-account@gmail.com&#39;<br># SRC ORG: 12345678901 source.example.com <br>export SRC_ORG_ID=&quot;12345678901&quot;<br>export SRC_ORG_DOMAIN=&#39;source.example.com&#39;<br># DST ORG: 45678901234 destination.example.com<br>export DST_ORG_ID=&quot;45678901234&quot;<br>export DST_ORG_DOMAIN=&#39;destination.example.com&#39;<br><br>$ gcloud beta projects move my-project-in-src-org \<br>  --organization=$DST_ORG_ID --quiet<br><br>- &#39;@type&#39;: type.googleapis.com/google.rpc.DebugInfo<br>  detail: |-<br>    [ORIGINAL ERROR] generic::permission_denied: The caller does not have permission<br>    com.google.apps.framework.request.StatusException: &lt;eye3 title=&#39;PERMISSION_DENIED&#39;/&gt; generic::PERMISSION_DENIED: The caller does not have permission [google.rpc.error_details_ext] { code: 7 message: &quot;The caller does not have permission&quot; }<br># Computer says no!</pre><p>The most powerful IAM permission you can have on a GCP Organization is organizationAdmin. Youâ€™d think that if you have that power, you can do <em>anything</em> in that universe, right? Think twice! There are additional powers that role doesnâ€™t have (and Iâ€™m kind of relieved it is this way).<br>One of them is the OrgPolicyAdmin, which means that as OrgAdmin, you first need to give yourself that power before you can use it (not very UNIX, I know, but definitely safer).</p><pre># Set IAM for SrcOrg<br>$ gcloud organizations add-iam-policy-binding $ORG_ID \<br>  --member=&#39;user:$ACCOUNT&#39; \<br>  --role=&#39;roles/resourcemanager.organizationAdmin&#39; \<br>  --role=&#39;roles/resourcemanager.projectIamAdmin&#39; \<br>  --role=&#39;roles/resourcemanager.projectMover&#39;  \<br>  --role=&#39;roles/orgpolicy.policyAdmin&#39;  \<br>  --condition=None</pre><p>For this command to work, you need the issuer (gcloud config get account) to have the power to grantâ€Šâ€”â€Šbut this is beside the scope of thisÂ doc.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/517/0*GSemn4o3mK4xKGGs" /><figcaption>In the UI it will look something likeÂ this</figcaption></figure><p>Note: Org Policies are documented <a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=it">here</a>.</p><h4>Error 2: Constraint `constraints/resourcemanager.allowedExportDestinations`</h4><p>Letâ€™s try to migrate a projectÂ now:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*E7XsdJVJDqFz9u1aka3Gqw.png" /><figcaption>This is NOT where I would have expected a Input/Output error!Â ğŸ˜†</figcaption></figure><p>Next step: Let me configure the <strong>allowedPolicyMemberDomains </strong>policy first.<em> (Why? It failed but I forgot to capture the error, my bad. For this error you just need to trustÂ me).</em></p><pre># This might fail..<br>$ gcloud beta projects move &quot;my-project-in-src-org&quot; \<br>  --organization=&quot;$DST_ORG_ID&quot; --quiet<br><br># This sets target customer_id!<br>$ gcloud resource-manager org-policies allow --organization &quot;$SRC_ORG_ID&quot; \<br>  iam.allowedPolicyMemberDomains &#39;C04abcdef&#39; # gives access to SrcOrg to Dest id</pre><p><strong>Note.</strong> The â€œC0..â€ id is the Directory Customer Id you get from gcloud organization list for your destination org.</p><p><em>- Iâ€™m readyâ€¦ Now itâ€™s going to work, Iâ€™m sure! <br>- Oh waitâ€¦Â ğŸ™ˆ</em></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*Zoc2xlTjUlowvAGn" /><figcaption>Damn, anotherÂ error!</figcaption></figure><p>What does it mean? It means that you need to configure your â€œOrg Firewallâ€ to allow projects out of your Source Organization. If youâ€™re a Cisco Certified engineerâ€Šâ€”â€Šyou already know what error is coming next.. <strong>Allowlisting paloozaÂ </strong>ğŸ˜œ<strong>!</strong></p><pre># Aloow SRC to export to DST<br>gcloud resource-manager org-policies allow --organization &quot;$SRC_ORG_ID&quot; \<br>  resourcemanager.allowedExportDestinations \<br>  &quot;under:organizations/$DST_ORG_ID&quot;<br># Note the &quot;under:&quot; needed to pass the policy all the way down from that folder</pre><h4>Error 3: constraints/resourcemanager.allowedImportSource</h4><p>This is similar to the error above, but itâ€™s from the receiving end.</p><p>To fix: damn I did it on the UI. My apologies. I would presume itâ€™s really the symmetrical opposite, like:</p><pre># This is me guessing but I should be too far. <br># TODO(ricc): remove powers from DST and try again<br>gcloud resource-manager org-policies allow --organization &quot;$DST_ORG_ID&quot; \<br>  resourcemanager.allowedImportSource \<br>  &quot;under:organizations/$SRC_ORG_ID&quot;</pre><h4>[optional] Refining theÂ security</h4><p>Note that to make things simple I gave a single user OrgAdmin for two organizations.</p><ul><li><strong>simple/insecure (pet project).</strong> The simple way is to have a single powerful account (gcloud account, eg â€œ<a href="mailto:poweruser@company.com">poweruser@company.com</a>â€) which has access to both SRC and DST orgs. This worked for me, as I was the sole owner of them all and I was under time pressure.</li><li><strong>complex/more secure (enterprises)</strong>. In a more enterprise scenario, youâ€™d have a less pressing time concern and you would probably be obliged to have smaller IAM permissions on both sides, probably having two individuals to carry on these two tasks. Which is why itâ€™s nice to have them gcloud-ed.</li></ul><p>In the second case, follow theÂ <a href="https://cloud.google.com/resource-manager/docs/assign-iam-roles?hl=it">docs</a>:</p><p><strong>Source OrgÂ :</strong></p><ul><li><strong>IAM: roles/resourcemanager.projectIamAdmin</strong> in the project to move (but if I want to do it at scale Iâ€™ll set it up in theÂ org)</li><li><strong>IAM: roles/resourcemanager.projectMover</strong> in the parent resource.<br>Again, if youâ€™re lazy you can just set these two at Org level and get it done once and for all. But then remember to remove this access at the end of the org move. You can also a time-bound IAM constraint ending tomorrowâ€Šâ€”â€Šthis is for lazy people like me who donâ€™t trust themselves to remember to close a parenthesis tomorrow and rather close it as you openÂ it.</li><li><strong>OrgPolicy</strong>: <strong>constraints/resourcemanager.allowedExportDestinations</strong>. You can set the domain id (â€œC0somethinâ€) as allowed destination or you can be lazy as me and just set them ALL, depending if youâ€™re an enterprise who wantgs to do it well or you just want to get it done soon and you donâ€™t care much of the org you leaveÂ behind.</li></ul><p>On the <strong>destination organization:</strong></p><ul><li><strong>IAM</strong>: ProjectMover</li><li><strong>Org Policy</strong>: constraints/resourcemanager.allowedImportSource</li></ul><h4>Meta-Scripts and tidy migration</h4><p>If you migrate 300 projects from 5 orgs into one, you might want to use Folders or itâ€™ll be a very nasty place tomorrow (<em>â€œwhere does this project come from again?â€)</em>. You can track pre-migration state in a few ways: you can dump the state on a lot of TXT in local file (but I usually remove them with my ruthless make cleans), on a Google Spreadsheet, or have your business logic do the job for you. Letâ€™s explore thisÂ one..</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*1KVyCI3Vy9g2nvZJ9gzZbQ.png" /><figcaption>Hereâ€™s the migration in a nutshell: all the Source folder structure complexity is flattened in the Destination under a single specialÂ folder.</figcaption></figure><p>I had some fun coding in Ruby (in a private repo which is in no shape to be publicized unless you make a lot of noise in the commentsÂ ğŸ˜‰).</p><p>Nothing better than a <strong>script</strong> which writes a <strong>script</strong> for you. This is useful when you want to iterate through 10 migrations but you know that ONE project doesnt fit into it -&gt; I create a 10 line blurb and then I just comment out the one I dont need. Itâ€™s also good for documenting which commands you ran on local file. Let me showÂ you.</p><pre><br>$ bin/13-gcloud-move-projects-to-joonix-under-domain.rb palladius.eu palladius-eu-infra prova-enonomai-palldius-eu  gcpprojects2sheets <br>[...]<br>gcloud beta projects move &#39;palladius-eu-infra&#39; --folder=&#39;1038774614299&#39; --quiet       # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu<br>gcloud beta projects move &#39;prova-enonomai-palldius-eu&#39; --folder=&#39;1038774614299&#39; --quiet       # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu<br>gcloud beta projects move &#39;gcpprojects2sheets&#39; --folder=&#39;1038774614299&#39; --quiet       # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu</pre><p>Note, this commands are dumped into a deterministically-named bash script which contains the commands, so I can comment out the projects I donâ€™t want to move (yet); the deterministic naming means that if I run it again, it will re-apply the same logic to the same file, which is good if you have it in version control and if the logic is not trivial (eg, find all projects under a folderÂ ğŸ˜‰).</p><p>Letâ€™s now call my ğŸ• pizza software (TM) after a make cache-clean to see if the migration worked:</p><pre>$ git clone https://github.com/palladius/org-folder-projects-graph/ <br>$ cd org-folder-projects-graph/<br>(base) ricc@mbp:ğŸ¡~/org-folder-projects-graph$ ./recurse_folders.rb palladius.joonix.net<br>[...]<br>â”œâ”€ ğŸ“‚ 133363080569 (Spostamenti CrossOrg)<br>    â”œâ”€ ğŸ“‚ 737267668168 (SPECIAL_ORPHANS)<br>        â”œâ”€ ğŸ• cicd-platinum-test041 (713582791007)<br>    â”œâ”€ ğŸ“‚ 1038774614299 (palladius-eu)<br>        â”œâ”€ ğŸ• original-bot-383907 (642248137380)<br>        â”œâ”€ ğŸ• prova-enonomai-palldius-eu (898096115869)<br>        â”œâ”€ ğŸ• gcpprojects2sheets (383820962508)<br>        â”œâ”€ ğŸ• palladius-eu-infra (845199147079)<br>[..]<br></pre><p>And it did! A round of applause.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/357/0*GIEcWaVhShNnjqI6" /><figcaption>Plenty of magic here: my script accepts a FolderId ( ğŸ‡®ğŸ‡¹ â€œCrossOrg Movemementsâ€) and it searches for the subfolder named like the domain (creating it if its not found).Â Wow!</figcaption></figure><p>My script was configured to generate a folder called like the org (changing dot with dash for obvious reasons): 133363080569. My script would create a subfolder if needed, get that folder id and create the scripts forÂ me:</p><pre>gcloud beta projects move &#39;palladius-eu-infra&#39; - folder=&#39;1038774614299&#39; - quiet # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu<br>gcloud beta projects move &#39;prova-enonomai-palldius-eu&#39; - folder=&#39;1038774614299&#39; - quiet # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu<br>gcloud beta projects move &#39;gcpprojects2sheets&#39; - folder=&#39;1038774614299&#39; - quiet # migrate project given via CLI to proper subfolder of palladius.joonix.net under palladius.eu</pre><p>After a lot of lost hours debugging, I wrote my bash code-writing ruby script to add meaningful comments aside the command. This was a stroke of genius (for my limited coding abilities) since all this movement includes non-mnemonic numbers, so using the domain names after the comment helped me understand what i wasÂ doing.</p><h4>Another error: bad chars in project nameÂ (!)</h4><p>Now, I donâ€™t know how many of you will find this error, but if you do, Google is your friend (and mine too) and youâ€™ll find this article, Iâ€™m sureÂ ğŸ˜„</p><p>I had project ids since 2012, and Iâ€™ve given them names which included parenthesis. For instance, the project id palladiusbonton-nobilling had an astonishing description (Project Name): â€œ<em>PalladiuBontonTest </em><strong><em>(</em></strong><em>No Billing</em><strong><em>)</em></strong>â€. Now this was never a problem in my life until some dayâ€¦ some of them gave me error. Interestingly enough, most came from one single error type: <a href="https://www.youtube.com/watch?v=KrZHPOeOxQQ">I gave my project ids a bad name</a>: I should have known better than BonÂ Jovi!</p><p>Solution: I scripted in ğŸ’ ruby a project description change which just removes the parenthesis (and the regex is DRY in case I find something new). To be on safe side, I change bad chars into <a href="https://www.youtube.com/watch?v=dg9Ae8ACTgw"><em>empty spaces</em></a> ğŸ™‚, as I love Queen more than BonÂ Jovi.</p><pre>$ bin/11-migrate-orphans.rb <br>[..]<br>goliardia2                     Goliardia2 (no billing uffi)              576689998257<br>palladiusbonton                palladiusbonton (billing disabled)        606248867298<br>palladiusbontontest-nobilling  PalladiuBontonTest (No Billing)           690861376600<br>riccardo-chatroom1             riccardo-chatroom-one (billing disabled)  941891472972<br># EXECUTE this to fix the project: <br>gcloud projects update &#39;palladiusbonton&#39; --name=&#39;palladiusbonton  billing disabled &#39; # Former description was: &#39;palladiusbonton (billing disabled)&#39;<br>palladiusbontontest-nobilling // 690861376600 ### &#39;PalladiuBontonTest (No Billing)&#39;<br># EXECUTE this to fix the project: <br>gcloud projects update &#39;palladiusbontontest-nobilling&#39; --name=&#39;PalladiuBontonTest  No Billing &#39; # Former description was: &#39;PalladiuBontonTest (No Billing)&#39;<br>riccardo-chatroom1 // 941891472972 ### &#39;riccardo-chatroom-one (billing disabled)&#39;<br># EXECUTE this to fix the project: <br>gcloud projects update &#39;riccardo-chatroom1&#39; --name=&#39;riccardo-chatroom-one  billing disabled &#39; # Former description was: &#39;riccardo-chatroom-one (billing disabled)&#39;</pre><p>Note the pattern: my 11th script creates an output with (1) the hopefully right command and (2) a human-readable description.</p><p>How do IgcloudÂ it?</p><pre>gcloud projects update &#39;project-id-or-number&#39; \<br>  --name=&#39;New Description without Parenthesis and stuff&#39;</pre><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*8d9udHN3wrwHeUv3" /><figcaption>..and here its how it looks if you have good eyes orÂ monitor.</figcaption></figure><h4>Wait: what about theÂ orphans?</h4><p>I noticed that not all projects were under an organization, some were orphans (ie, not attached to any organization).</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*C0W-d5Xa_F6c1E63.png" /><figcaption>A few orphan project ids, stranded in GoogleÂ Cloud</figcaption></figure><p>Now the <strong>migration</strong> script is the same as per other projects (<a href="https://cloud.google.com/sdk/gcloud/reference/beta/projects/move">documentation</a>):</p><pre>gcloud beta projects move $PROJECT_ID \<br>--{folder|organization} $DESTINATION_ID</pre><p>However, finding org-less projects require a different search, which took me a while. <a href="https://stackoverflow.com/questions/58543614/how-do-i-list-my-gcp-projects-under-no-organization-using-the-resource-manager-a">Let me Stackoverflow it forÂ you</a>:</p><pre>gcloud projects list --filter=&quot;parent.id.yesno(yes=&#39;Yes&#39;, no=&#39;No&#39;)=No&quot;<br># This returns the list of ptroject that current $ACCOUNT has access to</pre><p>Note that the definition of orphan depends on your identity (foo.bar@gmail.com), not from an org. Different users perceive different orphans, based on their access to projects. To make sure you see them all, you should iterate through all your accounts (<a href="https://gist.github.com/palladius/a99993feb7e6d78b7a2abea0a10c3242">code snippet</a>).</p><p><strong>Beware!</strong> While Org-ful projects are likely to all belong to you or your team, the Org-less projects could belong to anyone else! I moved by mistakes projects where I was owner but which belonged to another team. Make sure you look at permissions on those projects before migrating. <br>If youâ€™re not the sole owner, consider adding these projects to some <em>â€œdisputeâ€ spreadsheet</em> where you get the ok for the respective owners before moving (or any workflow which works forÂ you).</p><h3>Conclusions</h3><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*q5CwHu_9zctox7RL.png" /><figcaption>Success! I was able to migrate hundreds of projects from one org toÂ another</figcaption></figure><p>A few lessonÂ learnt:</p><ul><li>Being OrgAdmin is not enough, sometimes you need to call the Org PoliceÂ ğŸ‘®.</li><li>You need to allowlist the source domain to destination domain, and vice versa. Just like in a network firewall with two untrustworthy parts, which makesÂ sense.</li><li>I believe nobody documented this gcloud approach before (prove me wrongâ€Šâ€”â€Šor maybe not, as Iâ€™ve spent 72+ hours doing thisğŸ˜›). Researching the right gcloud filters is sometime a tediousÂ work.</li><li>Nothing helps more than a Migration Spreadsheet.</li><li>Write code which writes <em>and documents</em> code, particularly where you have to do with boring <em>numeric</em>Â ids.</li><li>Migrating N source orgs into N deterministically-named folders of a target destination org sub-folder was a <strong>really good idea</strong>.; by deterministically I mean: take the org domain and change dots with dashes (since dot are illegal): eg â€œexample-comâ€.</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*1KVyCI3Vy9g2nvZJ9gzZbQ.png" /><figcaption>Hereâ€™s the migration in a nutshell: all the Source folder structure complexity is flattened in the Destination under a single specialÂ folder.</figcaption></figure><p><strong>Please let me know if you find mistakes,</strong> or you find a failure domains I havenâ€™t described that can be <em>gclouded</em>Â , or any missing note. Thanks in advance.Â ğŸ˜™</p><h3>Next Steps</h3><ul><li>open source myÂ code:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/612/1*HwPOay1JOOHfgash9Mjd3w.png" /></figure><ul><li>recreate the source folder structure in the destination (!)</li><li>Bonus point to copy/preserve IAM and Org Policies across folders structure (although this probably needs some source/destination IAM mapping which is beside the scope of this article).</li><li>Put some code in a GitHubÂ Gist:</li></ul><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/3c408b048fe9b49c8ea3a56ab8dfd0d0/href">https://medium.com/media/3c408b048fe9b49c8ea3a56ab8dfd0d0/href</a></iframe><h3>URLography</h3><p>Pages I used to find answers toÂ this:</p><ul><li><a href="http://www.google.com">www.google.com</a></li><li><a href="https://github.com/palladius/org-folder-projects-graph/">https://github.com/palladius/org-folder-projects-graph/</a> Amazing script to dump yourÂ org</li><li><a href="https://cloud.google.com/resource-manager/docs/project-migration?hl=it">https://cloud.google.com/resource-manager/docs/project-migration</a> (official). It took me a while to understand there are 6 more pages to navigate on the left (see imageÂ below).</li><li><a href="https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints?hl=it">https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints</a> Org policies explained.</li><li><a href="https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6">https://medium.com/google-cloud/migrating-a-project-from-one-organization-to-another-gcp-4b37a86dd9e6</a> Yogesh wrote the article before me, but no gcloudÂ :)</li><li><a href="https://medium.com/google-cloud/setting-up-google-cloud-identity-for-multinational-companies-4afcbb18dee1">https://medium.com/google-cloud/setting-up-google-cloud-identity-for-multinational-companies-4afcbb18dee1</a> this guy is solving another problem, but heâ€™s usingÂ gcloud</li><li><a href="https://stackoverflow.com/questions/73411088/unable-to-migrate-gcp-project">https://stackoverflow.com/questions/73411088/unable-to-migrate-gcp-project</a></li><li><a href="https://stackoverflow.com/questions/61244749/how-to-list-all-projects-in-gcp-that-belongs-to-a-specific-organization">https://stackoverflow.com/questions/61244749/how-to-list-all-projects-in-gcp-that-belongs-to-a-specific-organization</a></li><li><a href="https://stackoverflow.com/questions/72781977/move-project-to-a-different-organization">https://stackoverflow.com/questions/72781977/move-project-to-a-different-organization</a></li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*gPA047UcE_wPuQ4pHTefDA.png" /></figure><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=c7e254ab90af" width="1" height="1" alt=""><hr><p><a href="https://medium.com/google-cloud/how-to-migrate-projects-across-organizations-c7e254ab90af">Migrate â˜ï¸ GCP projects across organizations, with gcloud</a> was originally published in <a href="https://medium.com/google-cloud">Google Cloud - Community</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[My favourite Toolchain]]></title>
            <link>https://medium.com/@palladiusbonton/my-favourite-toolchain-831b56ba6fc5?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/831b56ba6fc5</guid>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Wed, 12 Apr 2023 11:31:45 GMT</pubDate>
            <atom:updated>2023-04-12T12:32:30.014Z</atom:updated>
            <content:encoded><![CDATA[<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Zpiw3oLXwzs37UElBG4mIA.png" /><figcaption>How <em>midjourney</em> imagines my favourite Toolchain, in 4 familiar colorsÂ ;)</figcaption></figure><p>Recently, my alter ego Richard asked a provocative question: are you happy with your toolchain, is it modernÂ enough?</p><p>Before answering that question, o thought, first I need to assess it and enumerate it. Letâ€™s see ğŸ™ˆ what toolchain is:</p><ul><li><strong>Coding IDE</strong>: <strong>vscode</strong>. It is so amazing, Iâ€™ve tried something different, the OSS version, but itâ€™s fast, extensible and just wow. The only missing thing is, a fast edit-over-ssh. But itâ€™s not MSÂ fault.</li><li><strong>Favourite language:</strong> <strong>Ruby</strong>. I know what youâ€™re thinking, but it makes me happy, and efficient. Iâ€™ve tried other languages and frameworks, and nothing beats RoR in 2022 (Iâ€™ve spent 2 weekend to prove myself wrong, failing). If I need efficiency</li><li><strong>App Development: Ruby on Rails.</strong> Iâ€™ve given Js a go many times, itâ€™s spectacular on many parts, but developing an app in a DRY way (rather than duplicating code for BE/FE) and having a single solid choice over a fragmentation of libs for meÂ wins.</li><li><strong>CI: </strong>GCP <strong>Cloud Build</strong> and <a href="http://skaffoold.dev"><strong>skaffold</strong></a>. I might be biased as GooglerÂ here.</li><li><strong>CD</strong>: <strong>Cloud Deploy</strong> and <strong>GitHub actions</strong>. Again, biasedÂ ğŸ˜Š</li><li><strong>CI/CD</strong>: Skaffold plus GCP tooling on top of github repos. Use <strong>kustomize</strong> to DRY the manifests.</li><li><strong>Serverless</strong>: <strong>Cloud Run</strong> and <strong>App Engine</strong>. Never been a huge fan of Cloud functions, or maybe I just donâ€™t get themÂ :)</li><li><a href="https://en.wikipedia.org/wiki/Infrastructure_as_a_service"><strong>IaaS</strong></a><strong>Â : Google Cloud Platform</strong>. If you ask my favourite product, Iâ€™d say <strong>GCE</strong> as it was my firstÂ love.</li><li><strong>PaaS: App Engine </strong>+Â <strong>Heroku</strong>.</li><li><strong>SaaS: GitHub, Google Workspace, Atlassian Bitbucket</strong>.</li><li><strong>Infra as Code:</strong> <strong>Pulumi</strong> and <strong>Terraform</strong>. Back in the days,Â <strong>Chef</strong>.</li><li><strong>kubernetes</strong>: I love <strong>GKE</strong> remotely, and <strong>minikube</strong> locally. <strong>Kustomize</strong> to DRY my manifests. Not a big fan of Helm, tried it and hated it. Kpt is in my TODOÂ list.</li><li><strong>Docker</strong>: I love <strong>docker-compose</strong>, although it doesnâ€™t scale much. For simple single-apps, I use that. For more complex stuff, skaffold.</li><li><strong>Testing</strong>: I invented a bash testing suiteâ€Šâ€”â€Ša friend told me Iâ€™d become famousâ€Šâ€”â€ŠI didnâ€™t ğŸ˜ƒ. Happy to share code with you if you ask, and youâ€™re back to the asylumÂ tonight.</li></ul><p>More toÂ followâ€¦</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*m80mWeOX7BXq_ooi.png" /><figcaption>Infra as Code is so hot rightÂ now!</figcaption></figure><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=831b56ba6fc5" width="1" height="1" alt="">]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Ruby on Rails-like ORM and scaffolding in Golang anyone?]]></title>
            <link>https://medium.com/@palladiusbonton/ruby-on-rails-like-orm-in-golang-anyone-gopher-random-4558047da41?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/4558047da41</guid>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Thu, 22 Dec 2022 09:16:13 GMT</pubDate>
            <atom:updated>2023-04-19T14:42:45.257Z</atom:updated>
            <content:encoded><![CDATA[<figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*w8gS6tqRhLiC88zPy8S6_A.jpeg" /><figcaption>This is a typical Gopher writing codeâ€¦ on RailsÂ ğŸšˆ!</figcaption></figure><p>I â¤ï¸ Ruby on Rails. With all my ğŸ’›. I can rapid-prototype any 3â€“4 models app in a couple of hours and do a POC in an afternoon, and this is thanks to scaffolding. I can write this and RoR will create a proper Model, Controller, and ~4 Views (MVC) and DB schema with rock-solid change-managementÂ :</p><pre>rails generate scaffold Album title:string year:decimal singer:reference<br>rails generate scaffold Track title:string duration:decimal album:references<br>rails generate scaffold Article title:string body:string comment:string rating:integer url:string is_public:boolean<br><br>bundle exec rake db:migrate</pre><p>However, my colleagues bully me thatğŸ”»Ruby is dead, ğŸšˆ Rails is dead, and long live ğŸ“¦ Node.Js and so on. So I thought: itâ€™s ğŸ… December, letâ€™s learn a new language. I thought of learning C#â€Šâ€”â€Šjust kidding (Iâ€™m already a pianist)â€” I thought that Golang was the way to go. As of December 1st ğŸ…, everyone on Facebook has a single thing in mind: Whammageddon!</p><p>After taking a 2h course in Go and doing my first word count, my head got big and I thought: Iâ€™m now ready for the next step: a silly Whammageddon app to record my friends whammageddon spectacular stories!</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/640/0*DdSJzp9ib9Un8Nf-.jpg" /><figcaption><strong>Whammageddon rules</strong>â€Šâ€”â€Šif you just woke up from a criogenic coffin yesterdayÂ :)</figcaption></figure><h4>ğŸšˆ Golang on RailsÂ options</h4><p>I tried (meaning, I spent 2 hours each) a few options (Bee, Revel, Buffalo), and Iâ€™ll describe them in order. Note that I might be unfair to the first in chronological order as my ability to go get something wasnâ€™t as good as in try number 3Â :)</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*wSymZpyLJCBXn29b.png" /><figcaption>Queen Bee might be biased on whoÂ winsâ€¦</figcaption></figure><h4>1: ğŸÂ <a href="https://github.com/beego/beego">Beego</a></h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/757/1*I3y7zygaqbuHY2CMlqNIVQ.png" /><figcaption>Code source: <a href="https://github.com/beego/beego">https://github.com/beego/beego</a></figcaption></figure><p><a href="https://github.com/beego/beego">Beego</a> was the first Google result for â€œRuby on Railsâ€ for go. To be fair to bee, I was on a long flight to Israel and tried to make it work with jumpy airport internet and the experience was horrible (as a true Italian, I thought of filing a PR to enlarge gocapabilities with a new 4-letter verb). Nothing wrong with Bee,Â though.</p><p>This is how a migration looksÂ like:</p><p><strong>Pros</strong> ğŸ˜ƒ:</p><ul><li>I really enjoyed its ability to simply create ORM model from CLI.Â Example:</li></ul><pre>$ bee generate scaffold riccardo_post -fields &#39;title:string,body:text,active:bool,published:datetime&#39;</pre><ul><li>It also allows to have different models connecting to different datasources (wOOt! I wonder how you do a JOIN from Europe to Australia). Example:Â ```</li></ul><pre>bee generate scaffold user -fields=&quot;first_name:string:255,last_name:string:255,email:string:255&quot; -driver=postgres -conn=&quot;postgres://user:pass@localhost:5432/db?sslmode=disable&quot;<br>bee generate scaffold riccpost -fields=&quot;title:string,body:text&quot; -driver=mysql -conn=&quot;root:@tcp(127.0.0.1:3306)/test&quot;</pre><ul><li>CLI allows to create docs and <strong>swagger</strong> interface on the fly via bee run -downdoc=true -gendoc=trueÂ .</li><li>I ~supports <strong>80%</strong> <strong>scaffolding</strong> for <strong>model</strong>, controllers, <strong>DB/migration</strong> but creates an empty view (<a href="https://github.com/beego/bee/issues/102">github issue</a>). In my case, it gets the controller dependencies wrong (probably because its a monorepo) and I need to manually fix it ( long path to beego-whammageddon/models). ğŸ˜«</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*m2ybLgp4pQgKU5OelQQ9lA.png" /><figcaption>It politely asks me if I want to create model, controller, resource, migration and migrate the DB itself!Â Wow!</figcaption></figure><ul><li>bee dockerize creates a Dockerfile for you. Iâ€™ve always wished for the same onÂ RoR!</li></ul><p><strong>Cons </strong>ğŸ˜¢<strong>Â :</strong></p><ul><li>Lack of Scaffolding capabilities on the <strong>view</strong> side. It rocks on model/migration, but it doesnâ€™t create the neededÂ views.</li><li>Scaffolding on Controller side seems broken to me. I get Method Not Allowed, which is answered <a href="https://stackoverflow.com/questions/28545260/configure-beego-router-to-serve-index-html-for-angularjs-non-server-routes">here</a> (missing Get()functionâ€Šâ€”â€Šwhy would you doÂ that?!?)</li></ul><h4>2. ğŸ¥³Â <a href="https://revel.github.io/">Revel</a></h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/855/0*auID_UEO9MIMprUk.png" /><figcaption>Source: <a href="https://revel.github.io/">https://revel.github.io/</a></figcaption></figure><p>When <a href="https://levelup.gitconnected.com/golang-beego-vs-revel-how-to-choose-63ee8f081bc3">I read from Amrit</a>: â€œ If you have used Ruby on Rails, you are going to love Revel. If you are a Python developer who has used Django, you will like Beego.â€ I felt: what have I done in the past 4 hours?!? I had an agnition, or shall I sayâ€¦ a revelation!!</p><p>Revel has a very simple and straightforward <a href="http://revel.github.io/tutorial/firstapp.html">docs page</a> which will guide you through a multi-page, stateless form-rich hello world within 10Â minutes.</p><p>It has <a href="https://github.com/revel/modules"><strong>modules</strong></a> (pluggable packages) for NewRelic, Static files, Logging,Â ..</p><p>It has nice <a href="https://github.com/revel/examples"><strong>examples</strong></a> repos; the closest to Ror seems to be the Booking app (<a href="https://revel.github.io/examples/booking.html">docs</a>â€Šâ€”â€Š<a href="https://github.com/revel/examples/tree/master/booking">code</a>). Code is fromÂ 2020.</p><p>It uses <a href="https://github.com/go-gorp/gorp">GORP</a> as ORM. However, after first excitement, I realized also Revel lacks a proper way toÂ scaffold</p><p>I was too stupid to make it work and I threw the sponge. Hoewver with 2 lines you can actually get thisâ€Šâ€”â€Šwow!</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/715/1*tSpbPlJ-wQ8wrB07WbIqow.png" /></figure><p>Commands to achieve this (copied fromÂ <a href="https://github.com/revel/examples">here</a>):</p><pre>git clone https://github.com/revel/examples.git &quot;${GOPATH}/src/github.com/revel/examples&quot;<br>#DOESNT WORK FOR ME - I might be stuipid<br>revel run github.com/revel/examples/booking<br># THIS WORKS FOR ME<br>revel run &quot;${GOPATH}/src/github.com/revel/examples&quot;</pre><p>So if you have time to understand and reverse engineer the booking app, youâ€™re going to enjoy Revel a lot. However, the inability to scaffold from scratch is a real turn off forÂ me.</p><p>Here I totally failed to do any scaffolding: no model/controller/view for me. Iâ€™ll probably spend some time in the weekend reverse-engineering the booking appâ€¦Â ğŸ˜¢</p><h4>3. ğŸ¦¬<a href="https://gobuffalo.io/">Buffalo</a></h4><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*7OoJFpCz1UHBeHudcME5Gw.png" /><figcaption>source: <a href="https://gobuffalo.io/">https://gobuffalo.io/</a></figcaption></figure><p>Now, the first thing you see with Buffalo isâ€Šâ€”â€ŠwOOt? They even bothered adding a CSS! Clearly, thereâ€™s some money and a real company behind this (like DHH and Basecamp behind Rails). Graphics is captivating and I love itÂ already!</p><p>First, it uses <a href="https://gobuffalo.io/documentation/database/pop/"><strong>pop</strong></a> which supports PostgreS Cockroach MySQL and Sqlite3 out of theÂ box.</p><p>With <a href="https://gobuffalo.io/documentation/database/soda/">Soda</a> and <a href="https://gobuffalo.io/documentation/database/fizz/">Fizz</a>, you get a Rails-like experience in setting up the DB and migrating it:</p><pre>// migrate UP<br>create_table(&quot;users&quot;) {<br>  t.Column(&quot;email&quot;, &quot;string&quot;, {})<br>  t.Column(&quot;twitter_handle&quot;, &quot;string&quot;, {&quot;size&quot;: 50})<br>  t.Column(&quot;age&quot;, &quot;integer&quot;, {&quot;default&quot;: 0})<br>  t.Column(&quot;admin&quot;, &quot;bool&quot;, {&quot;default&quot;: false})<br>  t.Column(&quot;company_id&quot;, &quot;uuid&quot;, {&quot;default_raw&quot;: &quot;uuid_generate_v1()&quot;})<br>  t.Column(&quot;bio&quot;, &quot;text&quot;, {&quot;null&quot;: true})<br>  t.Column(&quot;joined_at&quot;, &quot;timestamp&quot;, {})<br>}<br><br>// migrate down<br>drop_table(&quot;users&quot;)</pre><p>This is absolutely fantasticÂ ! Unfortunately it doesnâ€™t seem to have the CLI interface to create a scaffold ğŸ˜, while you can reach a great experience by typing the code yourself.</p><p>To use generators, it looks to me you need to install pop as a separate module: <a href="https://github.com/gobuffalo/buffalo-pop">https://github.com/gobuffalo/buffalo-pop</a>. After doing so, you get buffalo pop g --help which returns <a href="https://gobuffalo.io/documentation/database/generators/">this same output</a>. (Before, it would return a weirdÂ output).</p><p>Now, I was able with a single command line (non documented anywhere, just by trying out!) to create a new model with my fields and also its migration, but not the controller and the viewsÂ :/</p><pre><br># For &#39;--skip-migration&#39; read below<br>buffalo pop g model --skip-migration foobar RiccTitle:string RiccDescription:text<br>buffalo pop g model --skip-migration barbaz RiccDescription:text UltimateAnswer:int32 Active:bool</pre><p>Note: he first time you call the function without skip miogration, but every subsequent invocation it will create another migration for the same model; so if you just want to auto-magically update the model until you got it right, you call it asÂ above.</p><p>Like in Rails, DB can be easily configured in a single YAML or via ENV variables.</p><pre># database.yaml<br>development:<br>  dialect: postgres<br>  database: whamageddon_buffalo_development<br>  user: postgres<br>  password: postgres<br>  host: 127.0.0.1<br>  pool: 5<br><br>test:<br>  url: {{envOr &quot;TEST_DATABASE_URL&quot; &quot;postgres://postgres:postgres@127.0.0.1:5432/whamageddon_buffalo_test?sslmode=disable&quot;}}<br><br>production:<br>  url: {{envOr &quot;DATABASE_URL&quot; &quot;postgres://postgres:postgres@127.0.0.1:5432/whamageddon_buffalo_production?sslmode=disable&quot;}}</pre><h4>[Golang vs Ruby] on ORM and Scaffolding</h4><p>So my first impressions on Go (vsÂ Ruby):</p><ul><li>â•blazing fast</li><li>â•compile in a single binaryâ€Šâ€”â€Šeasy to dockerize/ship.</li><li>â– Go has a tendency to want your app to be single repo. What if I want to have 3 folders under the same repoâ€Šâ€”â€Šcan I <em>MrÂ Go</em>?</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*0iP_R7AzQVGITIANUNtAuw.png" /><figcaption>No thanks Mr GoÂ :)</figcaption></figure><ul><li>â– Lack of a convincing zero-brain scaffolding technique.</li></ul><h4>Conclusions</h4><p>Like Bonucci told the Brits at the end of European Championship in London, <em>â€œ</em><a href="https://www.youtube.com/watch?v=69WrQRHicKU"><em>ne dovete mangiare di pastasciutta!</em></a><em>â€</em> (<em>you still have a lot of pasta to eat</em>), I believe Golang has still a long way to go to get to Ruby feasts when it comes to ORM and Rails rapid-prototyping.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/498/0*rwZiolVj9MrM3-Pf.gif" /><figcaption>Bonucci is a recognized national hero in Italy after this. Expect rolling the arm gesture to catch up with emojipedia startingÂ v14.0!</figcaption></figure><p>This morning, while swimming, I wanted to create a nice table with 3â€“5 stars for all, but Medium doesnâ€™t support tables. Hence Iâ€™ll just get the winner perÂ topic:</p><ul><li>Documentation: <strong>revel</strong> &amp;Â <strong>buffalo</strong></li><li>Look and feel:Â <strong>Buffalo</strong></li><li>Documentation for day-0 hello app:Â <strong>revel</strong>.</li><li>Model CLI creation: <strong>beego</strong>.</li><li>Migration: <strong>Buffalo</strong> (thanks toÂ <strong>fizz</strong>)</li><li>Scaffolding: <strong>none </strong><em>(railsÂ rulez)</em>.</li></ul><p>However, go has a long list of advantages that makes this passage worthwhile:</p><ul><li>damn easy <em>dockerization</em> (single chubbyÂ binary)</li><li>no dependencies craze in prod (single chubbyÂ binary)</li></ul><p>Note there are also other solution apart from Bee, Revel and Buffalo: <a href="https://github.com/gin-gonic/gin"><strong>Gin&amp;Gonic</strong></a>, <a href="https://github.com/goji/goji"><strong>Goji</strong></a>, <a href="https://github.com/kataras/iris-cli">Iris</a>,Â â€¦ and I hear <strong>echo</strong> also strikes a great balance (think of Sinatra if youâ€™re a rubyist).</p><p><strong>Note</strong>. Iâ€™m a ~day1 user of Go. Iâ€™m pretty sure some things Iâ€™ve said might be incorrect. Iâ€™d be honoured to get your feedback in form of comments.</p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=4558047da41" width="1" height="1" alt="">]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[My Macâ€™s battery on Google Cloud Monitoringâ€Šâ€”â€Šwith SMS if its low]]></title>
            <link>https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe?source=rss-b5293b96912f------2</link>
            <guid isPermaLink="false">https://medium.com/p/a1ccd70485fe</guid>
            <category><![CDATA[google-cloud-platform]]></category>
            <category><![CDATA[gcp-app-dev]]></category>
            <category><![CDATA[alerts]]></category>
            <category><![CDATA[monitoring]]></category>
            <category><![CDATA[cloud-monitoring]]></category>
            <dc:creator><![CDATA[Riccardo Carlesso]]></dc:creator>
            <pubDate>Wed, 09 Nov 2022 16:53:21 GMT</pubDate>
            <atom:updated>2022-11-24T16:50:39.904Z</atom:updated>
            <content:encoded><![CDATA[<h3>My Macâ€™s batteryğŸ”‹ on Google Cloud Monitoringâ€Šâ€”â€Šsend SMS if lowÂ ğŸª«</h3><blockquote><em>This article shows how you can easily inject a generic key/value into Google Cloud Monitoring and set up alerts on it. I use it to alert on disk space, and now also lowÂ battery!</em></blockquote><p>This morning I was in London, and I forgot my charger at home. With plenty of time but ğŸª« little battery, I thought: <em>hey! I need to have a way to predict when my battery is low! And I need to do it in a totally overkillÂ way!</em></p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*Yk6qFPAm6Y3Hwo5t" /><figcaption>Catching an early train from St Pancras to Stratford Intl then London CityÂ Airport.</figcaption></figure><p>My battery was at <strong>42%</strong>, which seemed a subtle indication my idea was worth blogging. Googling around, I found <a href="https://www.iphonetricks.org/check-battery-health-on-mac-using-terminal/">an article</a> which gave me the tip on how to script my Macâ€™s battery (note this only works for a <strong>Macbook</strong>).</p><p>Ugly code <a href="https://github.com/palladius/sakura/blob/master/bin/macbook-battery#L107-L150">here</a> (hey! Iâ€™m in an airport with no charger, do you want Unit testsÂ too?!?)</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/085df68699c21b7f54f45721065c2813/href">https://medium.com/media/085df68699c21b7f54f45721065c2813/href</a></iframe><p>I know, I call the same command 10 times and I could cache it. This is for the next iteration!</p><p>The best part of this is, not only I get my battery life, it also gives me my battery durabilityâ€Šâ€”â€Šso when I need to change battery.Â Woohoo!</p><p>There you go, letâ€™s try it out, let me just remove the cable so you dont get a boringÂ 100%.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*VVFX7-q7pyNbZaFayRGLmg.png" /><figcaption>Battery level is 98%. Unfortunately 14% of my battery potential seems goneÂ ğŸ˜¢</figcaption></figure><p>Battery is 98%, yay! Unfortunately seems like ~14% of my battery is gone. Luckily I donâ€™t pay for its repairÂ :)</p><h4>Step 2: push this metric to the â˜Â ï¸(GCP)</h4><p>Now, I want a script which emits my metric from CLI. So I can say something like push-to-gcp &lt;METRIC_NAME&gt; &lt;METRIC_VALUE&gt;.</p><p>Iâ€™ve coded my disk space a month ago, let me abstract it into some more reusable code (always Ruby): <a href="https://github.com/palladius/sakura/blob/master/bin/gcp-write-metric">palladius/sakura/gcp-write-metric</a>Â .</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/a73541e14f99aefb609f8ca056ccf574/href">https://medium.com/media/a73541e14f99aefb609f8ca056ccf574/href</a></iframe><p>Ok! Now letâ€™s try itÂ out.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/852/1*fFPP3gWU1mMpCUXLAyeBrQ.png" /><figcaption>Created the timeseries â€˜<strong>prova</strong>â€™ (test in italian) with meaningful number <strong>123</strong>!Â Wow!</figcaption></figure><p>Note you need to specify the project_id via ENV var (coming soon, theâ€Šâ€”â€Šproject option, or better the project_id auto inferral from gcloudÂ config).</p><p>Letâ€™s now glue the two scripts and upload the two Macbook info and see on the DevConsole:</p><iframe src="" width="0" height="0" frameborder="0" scrolling="no"><a href="https://medium.com/media/49258a59c0117f1018504c211725d963/href">https://medium.com/media/49258a59c0117f1018504c211725d963/href</a></iframe><p>This script requires a project_id in ARGV, then it does the work for you, knowing the fields which are useful from macbook-battery are coming from values 3 and 5 (yes, a JSON encoding/parsing would be less error prone!). Letâ€™s callÂ it:</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/925/1*CTX7IrQJgpI8qoFRDyA6Ug.png" /><figcaption>Meanwhile I went home, and launched this on my other M1 Mac. Always, boringly, attached to the current. Destined to an infinite life between 99 and 100%. Waitâ€Šâ€”â€Šthis Mac, although charged, is on hold until 80%. Maybe cells optimization? Iâ€™m impressed.</figcaption></figure><p>Once everything works, you need to â€œproductionize itâ€, which means setting up a Cron job (actually, <a href="https://www.launchd.info/">launchd</a>). I use. bash -lcto leverage PATH and other goodies from myÂ .bashrcbut I hope youâ€™re a better scripter and can make it work without that cumbersome import. Also make sure to add PATH correctly (I usually fail a few times before I get itÂ right).</p><pre>$ crontab -e </pre><pre>[â€¦]<br>PATH=/sbin:/bin:/usr/sbin:/usr/bin:~/git/sakura/bin/</pre><pre>3/5 * * * * bash -lc &#39;/Users/ricc/path-to/sakura/bin/gcp-write-mac-battery-values-on-project your-project-id&#39;<br>[â€¦]</pre><h3>Step3: View metric and Create dashboard</h3><p>Letâ€™s now head to the Metrics Explorer here and check a fake GCEÂ metric:</p><ul><li>Go to <a href="https://console.cloud.google.com/monitoring/metrics-explorer?project=ric-cccwiki">https://console.cloud.google.com/monitoring/metrics-explorer</a></li><li>In â€œSelect a metricâ€ &gt; Type â€œBatteryâ€ and see the options fall from many toÂ two:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/868/1*DlxGuBX4SYzrmN8EMIa38Q.png" /><figcaption>Here are my two metrics, CamelCased too!</figcaption></figure><ul><li>Select <strong>BatteryLife</strong>. This should take you to a nice dashboard (possibly empty if you just created thisâ€Šâ€”â€Šbe patient). Use the time control to go back in time or zoom until you get the desiredÂ view.</li><li>Since this signal comes from (possibly) multiple Macs, select â€œgroup byâ€ -&gt; <strong>hostname</strong>. You could see something likeÂ this:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*yeP5TnvyAr-9uXYhOUvr4w.png" /><figcaption>See battery for last day. My Mac (3) at home is always plugged in, the one at work (42) goes to meeting rooms from time to time. To be honest i unplugged it twice just to get a nice screenshotâ€Šâ€”â€Šcheater!</figcaption></figure><ul><li>Now click â€œ<strong>Save Chart</strong>â€ andÂ enjoy.</li></ul><p>Bingo! You can have a dashboard where you see side by side both <strong>BatteryLife</strong> and <strong>BatteryHealth</strong>.</p><h4>Step4. Set alerting when battery isÂ low</h4><p>Now letâ€™s get an alert when the battery is below 14% (42 divided byÂ Ï€).</p><ul><li>Open <a href="https://console.cloud.google.com/monitoring/alerting?project=ric-cccwiki">https://console.cloud.google.com/monitoring/alerting</a></li><li>Click â€œ<strong>+ Create Policy</strong>â€ (see <a href="https://gist.github.com/palladius/5c109015324fc6bffbfce2f58525760f">sample JSONÂ output</a>)</li><li>â€œ<strong>Select Metric</strong>â€ as above (type <em>BatteryLife</em>)</li><li><em>[optional] You may add a filter on the computer you care about: hostname = â€œmy-favorite-macâ€</em></li><li><em>Adjust TransformData parameters if youÂ wish.</em></li><li>Click â€œ<strong>Create Policy</strong>â€ -&gt; Configure AlertÂ trigger</li><li><strong>ConditionType</strong>: Threshold</li><li><strong>Position</strong>: Below threshold</li><li><strong>Threshold value</strong>: 14 (or value of your choice, likeÂ 20).</li><li>click <strong>CreateÂ Policy</strong></li><li>Finally, configure your <strong>Notification Channels</strong> (<a href="https://cloud.google.com/monitoring/support/notification-options">documentation</a>), where Iâ€™ve set up previously my email and swissÂ phone:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/308/1*GaEH0EttI6W24HeWAVLisw.png" /><figcaption>What life would be withoutÂ emojis?</figcaption></figure><ul><li>[optional] You can add some <strong>Policy User Labels</strong>. I enjoy using labels at all time (eg env=prod, scope=personal,Â ..).</li><li>[optional] You can fill in the <strong>Documentation</strong> like a Playbook. I always try to write something meaningful as part of <strong>SRE</strong> methodology (â€œ<strong><em>no alert is good if itâ€™s not actionableâ€</em></strong>). The action here is to attach your Mac to a powerÂ source.</li><li>Finally review the values and click <strong>ReviewÂ Alert</strong>:</li></ul><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/1*Fge8BQf73ReYJoUb5mdOMw.png" /></figure><h4>Conclusions</h4><p>In this brief article, weâ€™ve seen how you can script a meaningful metric from your machine, and inject it to Cloud Monitoring from commandÂ line.</p><p>Itâ€™s very easy to slice and dice these values (in this case aggregate by hostname), then dashboard and alert onÂ them.</p><figure><img alt="" src="https://cdn-images-1.medium.com/max/1024/0*clxCCRXccCBpxfET" /><figcaption>plug it to have battery or unplug it to see a niceÂ graph?</figcaption></figure><p>The sky is just the limit now. You can do something silly like counting your Chrome Tabs and alert when theyâ€™re more than 42 with some silly messages like â€œ<em>A message from the Galaxy: restartÂ Chrome!</em>â€</p><pre>brew install chrome-cli # only-once install<br>PROJECT_ID=my-project-123 gcp-write-metric mac-chrome-cli-ntabs $(chrome-cli list tabs | wc -l)</pre><p><em>Note: in the code I use â€œgce_instanceâ€ when I should be really using â€œglobalâ€ metric (</em><a href="https://cloud.google.com/monitoring/api/resources"><em>docs</em></a><em>). I loved GCE Instance as it already has hostname and GCP zone baked in, but itâ€™s incorrect (I tell GCP thatâ€™s a VM in the cloud, which is not). New code to support this is being developed in this amazing script:</em>ğŸŒ¸<em> </em><a href="https://github.com/palladius/sakura/blob/master/bin/gcp-write-metric-done-well">gcp-write-metric-done-well</a></p><img src="https://medium.com/_/stat?event=post.clientViewed&referrerSource=full_rss&postId=a1ccd70485fe" width="1" height="1" alt=""><hr><p><a href="https://medium.com/google-cloud/my-macs-battery-on-google-cloud-monitoring-with-sms-if-its-low-a1ccd70485fe">My Macâ€™s battery on Google Cloud Monitoringâ€Šâ€”â€Šwith SMS if its low</a> was originally published in <a href="https://medium.com/google-cloud">Google Cloud - Community</a> on Medium, where people are continuing the conversation by highlighting and responding to this story.</p>]]></content:encoded>
        </item>
    </channel>
</rss>